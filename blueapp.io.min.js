/* blueapp.io v0.0.1 */
function Characteristic(e,r,t,i){function s(e,r){params={},params[C.kPeripheralUUID]=c.uuid,params[C.kServiceUUID]=o.uuid,params[C.kCharacteristicUUID]=r.uuid,params[C.kIsNotifying]=r.isNotifying,params[C.kValue]=r.value,a.write(C.kSetValueNotification,params,e)}"object"==typeof process&&process+""=="[object process]"&&(C=require("./constants.js").C,Descriptor=require("./descriptor.js").Descriptor);var a=e,c=r,o=t;if(this.uuid=i,this.descriptors={},this.properties={},this.value="",this.characteristicName="",this.isNotifying=!1,Object.size=function(e){var r,t=0;for(r in e)e.hasOwnProperty(r)&&t++;return t},r.characteristicNames&&r.characteristicNames[i]){var n=r.characteristicNames[i];void 0!==n&&null!==n&&(this.characteristicName=n.name)}this.discoverDescriptors=function(e){if(e&&(this.ondiscoverDescriptors=e),this.descriptors&&Object.size(this.descriptors)>0)a.ondiscoverDescriptors(c,o,this);else{var r={};r[C.kPeripheralUUID]=c.uuid,r[C.kServiceUUID]=o.uuid,r[C.kCharacteristicUUID]=this.uuid,a.write(C.kGetDescriptors,r)}},this.ondiscoverDescriptors=function(e){if("undefined"!=typeof e)for(var r in e[C.kDescriptors]){var t=e[C.kDescriptors][r][C.kDescriptorUUID],i=this.descriptors[t];i||(i=new Descriptor(a,c,o,this,t));var s=e[C.kDescriptors][r][C.kProperties];for(var n in C.AllProperties)i.properties[C.AllProperties[n]]={enabled:s>>n&1,name:C.AllProperties[n]};this.descriptors[t]=i}},this.read=function(e){e&&(this.onread=e);var r={};r[C.kPeripheralUUID]=c.uuid,r[C.kServiceUUID]=o.uuid,r[C.kCharacteristicUUID]=this.uuid,a.write(C.kGetCharacteristicValue,r)},this.onread=function(e){this.isNotifying=e[C.kIsNotifying],this.value=e[C.kValue]},this.write=function(e,r){var t;t=1==this.properties.WriteWithoutResponse.enabled||1==this.properties.Indicate.enabled?C.kWriteWithoutResponse:C.kWriteResponse,this.writeWithResType(e,t,r)},this.writeWithResType=function(e,r,t){t&&(this.onwrite=t);var i={};i[C.kPeripheralUUID]=c.uuid,i[C.kServiceUUID]=o.uuid,i[C.kCharacteristicUUID]=this.uuid,i[C.kValue]=e,i[C.kWriteType]=r,a.write(C.kWriteCharacteristicValue,i)},this.onwrite=function(e,r){},this.notify=function(e,r){r&&(this.onread=r);var t={};t[C.kPeripheralUUID]=c.uuid,t[C.kServiceUUID]=o.uuid,t[C.kCharacteristicUUID]=this.uuid,t[C.kValue]=e,t[C.kIsNotifying]=e,this.isNotifying=e,a.write(C.kSetValueNotification,t)},this.indicate=function(e){e&&(this.onread=e);var r={};r[C.kPeripheralUUID]=c.uuid,r[C.kServiceUUID]=o.uuid,r[C.kCharacteristicUUID]=this.uuid,a.write(C.kGetCharacteristicValue,r)},this.broadcast=function(e){e&&(this.onread=e);var r={};r[C.kPeripheralUUID]=c.uuid,r[C.kServiceUUID]=o.uuid,r[C.kCharacteristicUUID]=this.uuid,a.write(C.kGetCharacteristicValue,r)},this.discoverDescriptorsRequest=function(e){if(!a.discoverDescriptorsRequest)throw Error("discoverDescriptorsRequest method not implemented by server");a.discoverDescriptorsRequest(e,c,o,this)},this.discoverDescriptorsResponse=function(e,r){if(r)a.sendErrorResponse(e,C.kGetCharacteristics,kError32603,r);else{params={};var t=[];for(var i in this.descriptors){var s={};s[C.kDescriptorUUID]=this.descriptors[i].uuid,s[C.kProperties]=this.descriptors[i].properties,s[C.kValue]=this.descriptors[i].value,s[C.kIsNotifying]=this.descriptors[i].isNotifying,t.push(s)}params[C.kDescriptors]=t,params[C.kPeripheralUUID]=c.uuid,params[C.kServiceUUID]=o.uuid,params[C.kCharacteristicUUID]=this.uuid,a.write(C.kGetDescriptors,params,e)}},this.readCharacteristicValueRequest=function(e,r){if(!a.readCharacteristicValueRequest)throw Error("readCharacteristicValueRequest method not implemented by server");a.readCharacteristicValueRequest(e,c,o,this)},this.writeCharacteristicValueRequest=function(e,r){if(!a.writeCharacteristicValueRequest)throw Error("writeCharacteristicValueRequest method not implemented by server");a.writeCharacteristicValueRequest(e,c,o,this,r[C.kValue])},this.enableNotificationsRequest=function(e,r){if(!a.enableNotificationsRequest)throw Error("enableNotificationsRequest method not implemented by server");a.enableNotificationsRequest(e,c,o,this,r[C.kIsNotifying])},this.respondToReadRequest=function(e,r){r?this.sendErrorResponse(e,C.kGetCharacteristicValue,C.kError32603,"Failed to read the Characteristic value"):(params={},params[C.kPeripheralUUID]=c.uuid,params[C.kServiceUUID]=o.uuid,params[C.kCharacteristicUUID]=this.uuid,params[C.kValue]=this.value,params[C.kIsNotifying]=this.isNotifying,a.write(C.kGetCharacteristicValue,params,e))},this.respondToWriteRequest=function(e,r){r?this.sendErrorResponse(e,C.kWriteCharacteristicValue,C.kError32603,"Failed to write the Characteristic value"):(params={},params[C.kPeripheralUUID]=c.uuid,params[C.kServiceUUID]=o.uuid,params[C.kCharacteristicUUID]=this.uuid,params[C.kValue]=this.value,a.write(C.kWriteCharacteristicValue,params,e))},this.respondWithNotification=function(e,r){this.value=r,s(e,this)},this.respondToChangeNotification=function(e,r){this.isNotifying=r,s(e,this)},this.addDescriptor=function(e){var r=new Descriptor(a,c,o,this,e);return this.descriptors[r.uuid]=r,r},this.updateValue=function(e){return this.value=e,this},this.updateProperties=function(e){return this.properties=e,this}}function Descriptor(e,r,t,i,s){var a=e,c=r,o=t,n=i;if(this.uuid=s,this.value="",this.descriptorName="",this.properties={},this.isNotifying=!1,r.descriptorNames&&r.descriptorNames[s]){var h=r.descriptorNames[s];void 0!==h&&null!==h&&(this.descriptorName=h.name)}this.updateValue=function(e){return this.value=e,this},this.updateProperties=function(e){return this.properties=e,this},this.read=function(e){e&&(this.onread=e);var r={};r[C.kPeripheralUUID]=c.uuid,r[C.kServiceUUID]=o.uuid,r[C.kCharacteristicUUID]=n.uuid,r[C.kDescriptorUUID]=this.uuid,a.write(C.kGetDescriptorValue,r)},this.onread=function(e){this.isNotifying=e[C.kIsNotifying],this.value=e[C.kValue]},this.write=function(e,r){r&&(this.onwrite=r);var t={};t[C.kPeripheralUUID]=c.uuid,t[C.kServiceUUID]=o.uuid,t[C.kCharacteristicUUID]=n.uuid,t[C.kDescriptorUUID]=this.uuid,t[C.kValue]=e,a.write(C.kWriteDescriptorValue,t)},this.onwrite=function(e){},this.readDescriptorValueRequest=function(e,r){if(!a.readDescriptorValueRequest)throw Error("readDescriptorValueRequest method not implemented by server");a.readDescriptorValueRequest(e,c,o,n,this)},this.writeDescriptorValueRequest=function(e,r){if(!a.writeDescriptorValueRequest)throw Error("writeDescriptorValueRequest method not implemented by server");a.writeDescriptorValueRequest(e,c,o,n,this,r[C.kValue])},this.respondToReadDescriptorValueRequest=function(e,r){r?this.sendErrorResponse(e,C.kGetDescriptorValue,C.kError32603,"Failed to read the descriptor value"):(params={},params[C.kPeripheralUUID]=c.uuid,params[C.kServiceUUID]=o.uuid,params[C.kCharacteristicUUID]=n.uuid,params[C.kDescriptorUUID]=this.uuid,params[C.kValue]=this.value,params[C.kIsNotifying]=this.isNotifying,a.write(C.kGetDescriptorValue,params,e))},this.respondToWriteDescriptorValueRequest=function(e,r){r?this.sendErrorResponse(e,C.kWriteDescriptorValue,C.kError32603,"Failed to write the descriptor value"):(params={},params[C.kPeripheralUUID]=c.uuid,params[C.kServiceUUID]=o.uuid,params[C.kCharacteristicUUID]=n.uuid,params[C.kDescriptorUUID]=this.uuid,params[C.kValue]=this.value,a.write(C.kWriteDescriptorValue,params,e))}}function GattIpServer(){function e(e,r){var t=r?"0x":"";for(var i in e){var s=(255&e[i]).toString(16);1==s.length&&(s="0"+s),t+=s}return t}function r(e){for(var r in e)if(e.hasOwnProperty(r))return!1;return JSON.stringify(e)===JSON.stringify({})}function t(e){var r={};if(e&&e.services)for(var t in e.services){var s={};s[C.kServiceUUID]=t,s[C.kIsPrimaryKey]=e.services[t].isPrimary,s[C.kCharacteristics]=i(e.services[t]),r[t]=s}return r}function i(e){var r={};if(e&&e.characteristics)for(var t in e.characteristics){var i={};i[C.kCharacteristicUUID]=t,i[C.kValue]=e.characteristics[t].value,i[C.kProperties]=e.characteristics[t].properties,i[C.kIsNotifying]=e.characteristics[t].isNotifying,i[C.kDescriptors]=s(e.characteristics[t]),r[t]=i}return r}function s(e){var r={};if(e&&e.descriptors)for(var t in e.descriptors){var i={};i[C.kDescriptorUUID]=t,i[C.kValue]=e.descriptors[t].value,i[C.kProperties]=e.descriptors[t].properties,i[C.kIsNotifying]=e.descriptors[t].isNotifying,r[t]=i}return r}"object"==typeof process&&process+""=="[object process]"&&(C=require("./constants.js").C,Peripheral=require("./peripheral.js").Peripheral,WebSocket=require("websocket").w3cwebsocket);var a;this.state=C.kUnknown,this.peripherals={},this.init=function(e,r){r&&(this.oninit=r),this.socket=new WebSocket(e),this.socket.onopen=function(){this.initWithServer(this.socket),this.oninit&&this.oninit()}.bind(this)},this.initWithServer=function(e){if(a=e,!a.send)throw Error("server must implement the send method");a.onmessage=this.processMessage.bind(this),a.onclose||(a.onclose=function(){}),a.onerror||(a.onerror=function(e){}),a.error||(a.onerror=function(e){})},this.processMessage=function(e){var r,t,i=JSON.parse(e.data);if("undefined"==typeof i||!i)return r={},r[C.kCode]=C.kInvalidRequest,void this.write(C.kError,r);if(i.result&&(i.result==C.kMessage||i.result==C.authenticate))return void this.onauthenticate(i.params,i.error);if(i.error)return void this.sendErrorResponse(void 0,i.method,C.kInvalidRequest,"Error in the Request");var s={id:i.id,session_id:i.session_id};switch(i.method){case C.kConfigure:this.configureRequest(s,i.params);break;case C.kScanForPeripherals:this.scanRequest(s,i.params[C.kScanOptionAllowDuplicatesKey],i.params[C.kServiceUUIDs]);break;case C.kStopScanning:this.stopScanRequest(s,i.params);break;case C.kConnect:try{t=this.getObjects(s,"P",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),this.connectRequest(s,t.peripheral)}catch(a){}break;case C.kDisconnect:try{t=this.getObjects(s,"P",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),this.disconnectRequest(s,t.peripheral)}catch(a){}break;case C.kCentralState:this.centralStateRequest(s,i.params);break;case C.kGetServices:try{t=this.getObjects(s,"P",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),t.peripheral.discoverServicesRequest(s)}catch(a){}break;case C.kGetIncludedServices:break;case C.kInvalidatedServices:break;case C.kGetCharacteristics:try{t=this.getObjects(s,"S",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),t.service.discoverCharacteristicsRequest(s)}catch(a){}break;case C.kGetDescriptors:try{t=this.getObjects(s,"C",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),t.characteristic.discoverDescriptorsRequest(s)}catch(a){}break;case C.kGetCharacteristicValue:try{t=this.getObjects(s,"C",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),t.characteristic.readCharacteristicValueRequest(s,i.params)}catch(a){}break;case C.kWriteCharacteristicValue:try{t=this.getObjects(s,"C",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),t.characteristic.writeCharacteristicValueRequest(s,i.params)}catch(a){}break;case C.kSetValueNotification:try{t=this.getObjects(s,"C",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),t.characteristic.isNotifying=i.params[C.kValue],t.characteristic.enableNotificationsRequest(s,i.params)}catch(a){}break;case C.kGetDescriptorValue:try{t=this.getObjects(s,"D",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),t.descriptor.readDescriptorValueRequest(s,i.params)}catch(a){}break;case C.kWriteDescriptorValue:try{t=this.getObjects(s,"D",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),t.descriptor.writeDescriptorValueRequest(s,i.params)}catch(a){}break;default:return void this.sendErrorResponse(s,i.method,C.kInvalidRequest,"Request not handled by server")}this.message=i},this.getObjects=function(e,r,t,i,s,a){var c={};if(c.peripheral=this.peripherals[t],c.peripheral){if("P"===r)return c;if(c.service=c.peripheral.services[i],c.service){if("S"===r)return c;if(c.characteristic=c.service.characteristics[s],c.characteristic){if("C"===r)return c;if(c.descriptor=c.characteristic.descriptors[a],c.descriptor)return c;throw this.sendErrorResponse(e,message.method,C.kErrorDescriptorNotFound,"Descriptor not found"),Error("Descriptor not found")}throw this.sendErrorResponse(e,message.method,C.kErrorCharacteristicNotFound,"Characteristic not found"),Error("Characteristic not found")}throw this.sendErrorResponse(e,message.method,C.kErrorServiceNotFound,"Service not found"),Error("Service not found")}throw this.sendErrorResponse(e,message.method,C.kErrorPeripheralNotFound,"Peripheral not found"),Error("Peripheral not found")},this.sendErrorResponse=function(e,r,t,i){var s={};params={},s[C.kCode]=t,s[C.kMessageField]=i,params[C.kError]=s,this.write(r,void 0,e,s)},this.authenticate=function(e){params={},params[C.kDeviceAccessToken]=e;var r={};r.method=C.kAuthenticate,r.params=params,r.id=C.id.toString(),C.id+=1,this.send(JSON.stringify(r))},this.configureRequest=function(){},this.configureResponse=function(e,r){r?this.sendErrorResponse(e,C.kConfigure,r):this.write(C.kConfigure,void 0,e)},this.centralStateRequest=function(){},this.centralStateResponse=function(e,r,t){t?this.write(C.kCentralState,params,e,t):(params={},params[C.kState]=r,this.write(C.kCentralState,params,e))},this.scanRequest=function(){},this.scanResponse=function(t,i,s,a,c,o,n,h,p){params={};var d,u;if(!r(h)){d={};for(var k in h){var v=k.toUpperCase();d[v]=e(h[k]).toUpperCase()}}if(!r(p)){u={};for(var l in p){var U=l.toUpperCase();u[U]=e(p[l]).toUpperCase()}}params[C.kPeripheralName]=i,params[C.kPeripheralUUID]=s,params[C.kPeripheralBtAddress]=a,params[C.kRSSIkey]=c,params[C.kCBAdvertisementDataTxPowerLevel]=o,params[C.kCBAdvertisementDataServiceUUIDsKey]=n&&n.length>0?n:void 0,params[C.kCBAdvertisementDataManufacturerDataKey]=d,params[C.kCBAdvertisementDataServiceDataKey]=u,this.write(C.kScanForPeripherals,params,t)},this.stopScanRequest=function(){},this.stopScanResponse=function(e,r){r?this.sendErrorResponse(e,C.kStopScanning,r):this.write(C.kStopScanning,void 0,e)},this.connectRequest=function(){},this.connectResponse=function(e,r,i){var s={};s[C.kPeripheralUUID]=r.uuid,s[C.kPeripheralName]=r.name;var a={};a=t(r),s[C.kServices]=a,i?this.sendErrorResponse(e,C.kConnect,i):this.write(C.kConnect,s,e)},this.disconnectRequest=function(){},this.disconnectResponse=function(e,r){r?this.write(C.kDisconnect,r):(params={},params[C.kPeripheralUUID]=e.uuid,params[C.kPeripheralName]=e.name,this.write(C.kDisconnect,params))},this.write=function(e,r,t,i){var s={};s.jsonrpc="2.0",s.result=e,s.params=r,s.error=i,t&&(s.id=t.id,s.session_id=t.session_id),this.send(JSON.stringify(s))},this.send=function(e){return a?void(1===a.readyState&&a.send(e)):void this.onerror("not connected")},this.close=function(e){a&&a.close()},this.addPeripheral=function(e,r,t,i,s,a,c,o){var n=new Peripheral(this,e,r,t,i,s,a,c,o);return this.peripherals[n.uuid]=n,n},this.GATM_SECURITY_PROPERTIES_NO_SECURITY=0,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_ENCRYPTION_WRITE=1,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_ENCRYPTION_WRITE=2,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_ENCRYPTION_READ=4,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_ENCRYPTION_READ=8,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_SIGNED_WRITES=16,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_SIGNED_WRITES=32,this.GATM_CHARACTERISTIC_PROPERTIES_BROADCAST=1,this.GATM_CHARACTERISTIC_PROPERTIES_READ=2,this.GATM_CHARACTERISTIC_PROPERTIES_WRITE_WO_RESP=4,this.GATM_CHARACTERISTIC_PROPERTIES_WRITE=8,this.GATM_CHARACTERISTIC_PROPERTIES_NOTIFY=16,this.GATM_CHARACTERISTIC_PROPERTIES_INDICATE=32,this.GATM_CHARACTERISTIC_PROPERTIES_AUTHENTICATED_SIGNED_WRITES=64,this.GATM_CHARACTERISTIC_PROPERTIES_EXT_PROPERTIES=128,this.GATM_DESCRIPTOR_PROPERTIES_READ=1,this.GATM_DESCRIPTOR_PROPERTIES_WRITE=2}function GATTIP(){"object"==typeof process&&process+""=="[object process]"&&(C=require("./constants.js").C,Peripheral=require("./peripheral.js").Peripheral,WebSocket=require("websocket").w3cwebsocket);var e;this.peripherals={},this.init=function(e,r){r&&(this.oninit=r),this.socket=new WebSocket(e),this.socket.onopen=function(){this.initWithClient(this.socket),this.oninit&&this.oninit()}.bind(this)},this.initWithClient=function(r){this.state=C.kUnknown,e=r,e.onmessage=this.processMessage.bind(this)},this.processMessage=function(e){var r,t,i,s=JSON.parse(e.data),a={};switch(s.result){case C.kConfigure:this.onconfigure(s.params,s.error);break;case C.kScanForPeripherals:s.params&&s.params[C.kPeripheralUUID]&&(r=this.peripherals[s.params[C.kPeripheralUUID]]),r?r.updatePeripheral(s.params[C.kPeripheralName],s.params[C.kPeripheralBtAddress],s.params[C.kRSSIkey],s.params[C.kCBAdvertisementDataTxPowerLevel],s.params[C.kCBAdvertisementDataServiceUUIDsKey],s.params[C.kCBAdvertisementDataManufacturerDataKey],s.params[C.kCBAdvertisementDataServiceDataKey],s.params[C.kAdvertisementDataKey],s.params[C.kScanRecord]):(r=new Peripheral(this,s.params[C.kPeripheralName],s.params[C.kPeripheralUUID],s.params[C.kPeripheralBtAddress],s.params[C.kRSSIkey],s.params[C.kCBAdvertisementDataTxPowerLevel],s.params[C.kCBAdvertisementDataServiceUUIDsKey],s.params[C.kCBAdvertisementDataManufacturerDataKey],s.params[C.kCBAdvertisementDataServiceDataKey],s.params[C.kAdvertisementDataKey],s.params[C.kScanRecord]),this.peripherals[s.params[C.kPeripheralUUID]]=r),this.onscan(r,s.error);break;case C.kStopScanning:this.onstopScan(s.error);break;case C.kConnect:if(s.params&&s.params[C.kPeripheralUUID]&&(r=this.peripherals[s.params[C.kPeripheralUUID]]),s.error)r&&r.onconnect(s.error);else if(r){r.ondiscoverServices(s.params,s.error);for(var c in s.params[C.kServices])if(t=r.services[c]){t.ondiscoverCharacteristics(s.params[C.kServices][c],s.error);for(var o in t.characteristics)i=t.characteristics[o],i?i.ondiscoverDescriptors(s.params[C.kServices][t.uuid][C.kCharacteristics][o],s.error):this.onerror("Characteristic not found")}else this.onerror("Service not found");r.onconnect()}else this.onerror("Peripheral not found");this.onconnect(r,s.error);break;case C.kDisconnect:s.params&&(a=this.getObjects("P",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.peripheral&&a.peripheral.ondisconnect(s.error)),this.ondisconnect(a.peripheral,s.error);break;case C.kCentralState:this.state=s.params[C.kState],this.onstate(s.params[C.kState],s.error);break;case C.kGetServices:s.params&&(a=this.getObjects("P",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.peripheral&&a.peripheral.ondiscoverServices(s.params,s.error)),this.ondiscoverServices(a.peripheral,s.error);break;case C.kGetCharacteristics:s.params&&(a=this.getObjects("S",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.service&&a.service.ondiscoverCharacteristics(s.params,s.error)),this.ondiscoverCharacteristics(a.peripheral,a.service,s.error);break;case C.kGetDescriptors:s.params&&(a=this.getObjects("C",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.characteristic&&a.characteristic.ondiscoverDescriptors(s.params,s.error)),this.ondiscoverDescriptors(a.peripheral,a.service,a.characteristic,s.error);break;case C.kGetCharacteristicValue:s.params&&(a=this.getObjects("C",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.characteristic&&a.characteristic.onread(s.params,s.error)),this.onupdateValue(a.peripheral,a.service,a.characteristic,s.error);break;case C.kWriteCharacteristicValue:s.params&&(a=this.getObjects("C",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.characteristic&&a.characteristic.onwrite(s.params,s.error)),this.onwriteValue(a.peripheral,a.service,a.characteristic,s.error);break;case C.kSetValueNotification:s.params&&(a=this.getObjects("C",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.characteristic&&(a.characteristic.isNotifying=s.params[C.kIsNotifying],a.characteristic.value=s.params[C.kValue])),this.onupdateValue(a.peripheral,a.service,a.characteristic,s.error);break;case C.kGetDescriptorValue:s.params&&(a=this.getObjects("D",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.descriptor&&a.descriptor.onread(s.params,s.error)),this.ondescriptorRead(a.peripheral,a.service,a.characteristic,a.descriptor,s.error);break;case C.kWriteDescriptorValue:s.params&&(a=this.getObjects("D",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.descriptor&&a.descriptor.onwrite(s.params,s.error)),this.ondescriptorWrite(a.peripheral,a.service,a.characteristic,a.descriptor,s.error);break;case C.kGetRSSI:s.params&&(a=this.getObjects("P",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.peripheral&&(a.peripheral.name=s.params[C.kPeripheralName],a.peripheral.rssi=s.params[C.kRSSIkey])),this.onupdateRSSI(a.peripheral,s.error);break;case C.kPeripheralNameUpdate:s.params&&(a=this.getObjects("P",s.params[C.kPeripheralUUID],s.params[C.kServiceUUID],s.params[C.kCharacteristicUUID],s.params[C.kDescriptorUUID]),a.peripheral&&(a.peripheral.name=s.params[C.kPeripheralName],a.peripheral.rssi=s.params[C.kRSSIkey])),this.onupdateRSSI(a.peripheral,s.error);break;case C.kAuthenticate:case C.kMessage:this.onauthenticate(s.params,s.error);break;default:this.onerror("invalid response"),this.message=s}},this.getObjects=function(e,r,t,i,s){var a={};if(a.peripheral=this.peripherals[r],a.peripheral){if("P"===e)return a;if(a.service=a.peripheral.services[t],a.service){if("S"===e)return a;if(a.characteristic=a.service.characteristics[i],a.characteristic){if("C"===e)return a;if(a.descriptor=a.characteristic.descriptors[s],a.descriptor){if("D"===e)return a}else this.onerror("Descriptor not found")}else this.onerror("Characteristic not found")}else this.onerror("Service not found")}else this.onerror("Peripheral not found");return a},this.oninit=function(e){},this.authenticate=function(e){params={},params[C.kDeviceAccessToken]=e;var r={};r.method=C.kAuthenticate,r.params=params,r.id=C.id.toString(),C.id+=1,this.send(JSON.stringify(r))},this.configure=function(e,r,t){t&&(this.onconfigure=t);var i={};i[C.kShowPowerAlert]=e,i[C.kIdentifierKey]=r,this.write(C.kConfigure,i)},this.onconfigure=function(e){},this.scan=function(e,r,t){t&&(this.onscan=t),this.peripherals={};var i={};i[C.kScanOptionAllowDuplicatesKey]=e,i[C.kServiceUUIDs]=r,this.write(C.kScanForPeripherals,i)},this.onscan=function(e){},this.stopScan=function(e){e&&(this.onscan=e);var r={};this.write(C.kStopScanning,r)},this.onstopScan=function(e){},this.centralState=function(){var e={};this.write(C.kCentralState,e)},this.onstate=function(e){},this.onerror=function(e){},this.close=function(r){e&&e.close()},this.onclose=function(e,r){},this.onconnect=function(e){},this.ondisconnect=function(e){},this.ondiscoverServices=function(e){},this.ondiscoverCharacteristics=function(e){},this.ondiscoverDescriptors=function(e){},this.onupdateValue=function(e){},this.onwriteValue=function(e){},this.onupdateRSSI=function(e){},this.onMessage=function(e){},this.ondescriptorRead=function(e,r,t,i,s){},this.ondescriptorWrite=function(e,r,t,i,s){},this.write=function(e,r,t){var i={};i.jsonrpc="2.0",i.method=e,i.params=r,i.id=C.id.toString(),C.id+=1,this.send(JSON.stringify(i))},this.send=function(r){return e?void(1===e.readyState&&e.send(r)):void this.onerror("not connected")}}function Peripheral(e,r,t,i,s,a,c,o,n,h,p){function d(e,r){return-1==e.indexOf(r)?(e.push(r),!0):!1}function u(e){var r=parseInt(e.advdata[0],16);parseInt(e.advdata[2],16)>=1?e.discoverable="true":e.discoverable="false",e.advdata.splice(0,r+1)}function k(e){var r=parseInt(e.advdata[0],16);e.txpowerLevel=parseInt(e.advdata[2]),e.advdata.splice(0,r+1)}function v(e){var r=parseInt(e.advdata[0],16);if(r>2){for(var t=e.advdata[3]+e.advdata[2],i="",s=4;r>=s;s++)i+=e.advdata[s];e.manufacturerData[t]=i}e.advdata.splice(0,r+1)}function l(e){for(var r=parseInt(e.advdata[0],16),t="",i=r;i>=2;i--)t+=e.advdata[i];e.serviceUUIDs[0]=t,e.advdata.splice(0,r+1)}function U(e){for(var r=parseInt(e.advdata[0],16),t="",i=r;i>=2;i--)t+=e.advdata[i],14!=i&&12!=i&&10!=i&&8!=i||(t+="-");e.serviceUUIDs[0]=t,e.advdata.splice(0,r+1)}function I(e){for(var r=parseInt(e.advdata[0],16),t="",i=3;i>=2;i--)t+=e.advdata[i];"FEAA"==t&&(0===parseInt(e.advdata[4],16)?m(e):16==parseInt(e.advdata[4],16)?D(e):32==parseInt(e.advdata[4],16)&&f(e)),e.advdata.splice(0,r+1)}function m(e){e.frameType="UID",e.nameSpace="",e.instanceID="",e.txpowerLevel=parseInt(e.advdata[5],16);for(var r=6;16>r;r++)e.nameSpace+=e.advdata[r];for(var t=16;22>t;t++)e.instanceID+=e.advdata[t];e.reserved=e.advdata[22],e.reserved+=e.advdata[23]}function D(e){e.frameType="URL",e.txpowerLevel=parseInt(e.advdata[5]);for(var r in C.AllProtocols)advdata[6]==r&&(e.url=C.AllProtocols[r]);for(var t=7;t<advdataLength;t++)e.url+=String.fromCharCode(parseInt(e.advdata[t],16));for(var i in C.AllDomains)e.advdata[advdataLength]==i&&(e.url+=C.AllDomains[i])}function f(e){e.frameType="TLM",e.advPacketCount="",e.timeInterval="",e.batteryVoltage="",e.eddyVersion=parseInt(e.advdata[5],16);for(var r=6;8>r;r++)e.batteryVoltage+=e.advdata[r];e.batteryVoltage=parseInt(e.batteryVoltage,16),e.temperature=Math.ceil(parseInt(e.advdata[8],16)),e.temperature+=".";var t=Math.ceil(1/256*parseInt(e.advdata[9],16));t.length>2?e.temperature+=t.toString().substring(0,2):e.temperature+=t;for(var i=10;14>i;i++)e.advPacketCount+=e.advdata[i];e.advPacketCount=parseInt(e.advPacketCount,16);for(var s=14;18>s;s++)e.timeInterval+=e.advdata[s];if(e.timeInterval=Math.ceil(.1*parseInt(e.timeInterval,16)),e.timePeriod="",e.timeInterval>=60){var a=Math.floor(e.timeInterval/86400);a>0&&(e.timePeriod+=10>a?a+"day ":a+"days ",e.timeInterval-=24*a*60*60);var c=Math.floor(e.timeInterval/3600);c>0?(e.timePeriod+=10>c?"0"+c+":":c+":",e.timeInterval-=60*c*60):e.timePeriod+="00:";var o=Math.floor(e.timeInterval/60);o>0?(e.timePeriod+=10>o?"0"+o+":":o+":",e.timeInterval-=60*o,e.timePeriod+=e.timeInterval<10?"0"+e.timeInterval:e.timeInterval,e.timePeriod+=" secs",e.timeInterval=0):(e.timePeriod+="00:"+e.timeInterval,e.timeInterval=0)}else e.timeInterval>0&&e.timeInterval<60&&(e.timePeriod+=e.timeInterval<10?"00:00:0"+e.timeInterval:"00:00:"+e.timeInterval,e.timePeriod+=" secs")}"object"==typeof process&&process+""=="[object process]"&&(C=require("./constants.js").C,Service=require("./service.js").Service);var S=e;this.uuid=t,this.manufacturerData={},this.serviceData={},this.serviceUUIDs=[],this.services={},this.isConnected=!1;var P=this;this.serviceNames,this.characteristicNames,this.descriptorNames,Object.size=function(e){var r,t=0;for(r in e)e.hasOwnProperty(r)&&t++;return t},this.updatePeripheral=function(e,r,t,i,s,a,c,o,n){this.init(e,r,t,i,s,a,c,o,n)},this.init=function(e,r,t,i,s,a,c,o,n){var h=!0;if(this.name=e,this.addr=r,this.rssi=t,this.txpowerLevel=i,this.advertisementData=o,this.scanData=n,o&&(this.rawAdvertisingData=o[C.kRawAdvertisementData]),this.advdata=new Array,"undefined"!=typeof this.rawAdvertisingData){if(this.rawAdvertisingData.length%2===0)for(var p=0;p<this.rawAdvertisingData.length;p+=2)this.advdata[p/2]=this.rawAdvertisingData.charAt(p)+this.rawAdvertisingData.charAt(p+1);else for(var m=0;m<this.rawAdvertisingData.length;m++)this.advdata[m]=this.rawAdvertisingData.charAt(2*m)+this.rawAdvertisingData.charAt(2*m+1);do{if(this.advdata[1]==C.kGAP_ADTYPE_FLAGS)u(this);else if(this.advdata[1]==C.kGAP_ADTYPE_POWER_LEVEL)k(this);else if(this.advdata[1]==C.kGAP_ADTYPE_INCOMPLETE_16BIT_SERVICEUUID||this.advdata[1]==C.kGAP_ADTYPE_COMPLETE_16BIT_SERVICEUUID)l(this);else if(this.advdata[1]==C.kGAP_ADTYPE_INCOMPLETE_32BIT_SERVICEUUID||this.advdata[1]==C.kGAP_ADTYPE_COMPLETE_32BIT_SERVICEUUID)l(this);else if(this.advdata[1]==C.kGAP_ADTYPE_INCOMPLETE_128BIT_SERVICEUUID||this.advdata[1]==C.kGAP_ADTYPE_COMPLETE_128BIT_SERVICEUUID)U(this);else if(this.advdata[1]==C.kGAP_ADTYPE_MANUFACTURER_SPECIFIC)v(this);else if(this.advdata[1]==C.kGAP_ADTYPE_16BIT_SERVICE_DATA)I(this);else if("00"==this.advdata[1])this.advdata.splice(0,1);else{var D=parseInt(this.advdata[0],16);this.advdata.splice(0,D+1)}0===this.advdata.length&&(h=!1)}while(h)}if("undefined"!=typeof a&&"[object Object]"===Object.prototype.toString.call(a))if(this.manufacturerData&&Object.size(this.manufacturerData)>0)for(var f in a)this.manufacturerData[f]=a[f];else this.manufacturerData=a;if("undefined"!=typeof c&&"[object Object]"===Object.prototype.toString.call(c))if(this.serviceData&&Object.size(this.serviceData)>0)for(var S in c)this.serviceData[S]=c[S];else this.serviceData=c;if("undefined"!=typeof s&&"[object Array]"===Object.prototype.toString.call(s))if(this.serviceUUIDs&&this.serviceUUIDs.length>0)for(var P=0;P<s.length;P++)d(this.serviceUUIDs,s[P]);else this.serviceUUIDs=s},this.init(r,i,s,a,c,o,n,h,p),this.getManufacturerDataById=function(e){if("number"==typeof e){e=""+Number(e).toString(16);for(var r="",t=e.length;4>t;t++)r+="0";e=r+e}return this.manufacturerData[e]},this.getServiceDataByUUID=function(e){return this.serviceData[e]},this.connect=function(e){e&&(this.onconnect=e);var r={};r[C.kPeripheralUUID]=P.uuid,S.write(C.kConnect,r)},this.onconnect=function(e){e||(this.isConnected=!0)},this.disconnect=function(e){e&&(this.onconnect=e);var r={};r[C.kPeripheralUUID]=this.uuid,S.write(C.kDisconnect,r)},this.ondisconnect=function(e){e||(this.isConnected=!1)},this.discoverServices=function(e){if(e&&(this.ondiscoverServices=e),this.services&&Object.size(this.services)>0)S.ondiscoverServices(this);else{var r={};r[C.kPeripheralUUID]=this.uuid,S.write(C.kGetServices,r)}},this.ondiscoverServices=function(e){for(var r in e[C.kServices]){var t=e[C.kServices][r][C.kServiceUUID],i=this.services[t];i||(i=new Service(S,this,t)),this.services[t]=i}},this.updateRSSI=function(e){e&&(this.onupdateRSSI=e);var r={};r[C.kPeripheralUUID]=this.uuid,S.write(C.kGetRSSI,r)},this.onupdateRSSI=function(e){},this.discoverServicesRequest=function(e){if(!S.discoverServicesRequest)throw Error("discoverServicesRequest method not implemented by server");S.discoverServicesRequest(e,this)},this.discoverServicesResponse=function(e,r){if(r)S.sendErrorResponse(e,C.kGetServices,kError32603,r);else{params={};var t=[];for(var i in this.services){var s={};s[C.kServiceUUID]=this.services[i].uuid,s[C.kIsPrimaryKey]=this.services[i].isPrimary,t.push(s)}params[C.kServices]=t,params[C.kPeripheralUUID]=this.uuid,S.write(C.kGetServices,params,e)}},this.addService=function(e){var r=new Service(S,this,e);return this.services[r.uuid]=r,r}}function Service(e,r,t){"object"==typeof process&&process+""=="[object process]"&&(C=require("./constants.js").C,Characteristic=require("./characteristic.js").Characteristic);var i=e,s=r;if(this.uuid=t,this.isPrimary=!0,this.characteristics={},this.includedServices={},this.serviceName="",Object.size=function(e){var r,t=0;for(r in e)e.hasOwnProperty(r)&&t++;return t},r.serviceNames&&r.serviceNames[t]){var a=r.serviceNames[t];void 0!==a&&null!==a&&(this.serviceName=a.name)}this.discoverIncludedServices=function(e){},this.ondiscoverIncludedServices=function(e){},
this.discoverCharacteristics=function(e){if(e&&(this.ondiscoverCharacteristics=e),this.characteristics&&Object.size(this.characteristics)>0)i.ondiscoverCharacteristics(s,this);else{var r={};r[C.kPeripheralUUID]=s.uuid,r[C.kServiceUUID]=this.uuid,i.write(C.kGetCharacteristics,r)}},this.ondiscoverCharacteristics=function(e){for(var r in e[C.kCharacteristics]){var t=e[C.kCharacteristics][r][C.kCharacteristicUUID],a=this.characteristics[t];a||(a=new Characteristic(i,s,this,t)),this.characteristics[t]=a,a.value=e[C.kCharacteristics][r][C.kValue];var c=e[C.kCharacteristics][r][C.kProperties];for(var o in C.AllProperties)a.properties[C.AllProperties[o]]={enabled:c>>o&1,name:C.AllProperties[o]};a.isNotifying=e[C.kCharacteristics][r][C.kIsNotifying]}},this.discoverCharacteristicsRequest=function(e){if(!i.discoverCharacteristicsRequest)throw Error("discoverCharacteristicsRequest method not implemented by server");i.discoverCharacteristicsRequest(e,s,this)},this.discoverCharacteristicsResponse=function(e,r){if(r)i.sendErrorResponse(e,C.kGetCharacteristics,kError32603,r);else{params={};var t=[];for(var a in this.characteristics){var c={};c[C.kCharacteristicUUID]=this.characteristics[a].uuid,c[C.kProperties]=this.characteristics[a].properties?this.characteristics[a].properties:"",c[C.kValue]=this.characteristics[a].value,c[C.kIsNotifying]=this.characteristics[a].isNotifying,t.push(c)}params[C.kCharacteristics]=t,params[C.kPeripheralUUID]=s.uuid,params[C.kServiceUUID]=this.uuid,i.write(C.kGetCharacteristics,params,e)}},this.addCharacteristic=function(e){var r=new Characteristic(i,s,this,e);return this.characteristics[r.uuid]=r,r}}"object"==typeof process&&process+""=="[object process]"&&"undefined"!=typeof exports&&(exports.Characteristic=Characteristic);var C={kError:"error",kCode:"code",kMessageField:"message",kMethod:"method",kResult:"result",kIdField:"id",kSessionIdField:"session_id",kConfigure:"aa",kScanForPeripherals:"ab",kStopScanning:"ac",kConnect:"ad",kDisconnect:"ae",kCentralState:"af",kGetConnectedPeripherals:"ag",kGetPerhipheralsWithServices:"ah",kGetPerhipheralsWithIdentifiers:"ai",kGetServices:"ak",kGetIncludedServices:"al",kGetCharacteristics:"am",kGetDescriptors:"an",kGetCharacteristicValue:"ao",kGetDescriptorValue:"ap",kWriteCharacteristicValue:"aq",kWriteDescriptorValue:"ar",kSetValueNotification:"as",kGetPeripheralState:"at",kGetRSSI:"au",kInvalidatedServices:"av",kPeripheralNameUpdate:"aw",kMessage:"zz",kCentralUUID:"ba",kPeripheralUUID:"bb",kPeripheralName:"bc",kPeripheralUUIDs:"bd",kServiceUUID:"be",kServiceUUIDs:"bf",kPeripherals:"bg",kIncludedServiceUUIDs:"bh",kCharacteristicUUID:"bi",kCharacteristicUUIDs:"bj",kDescriptorUUID:"bk",kServices:"bl",kCharacteristics:"bm",kDescriptors:"bn",kProperties:"bo",kValue:"bp",kState:"bq",kStateInfo:"br",kStateField:"bs",kWriteType:"bt",kRSSIkey:"bu",kIsPrimaryKey:"bv",kIsBroadcasted:"bw",kIsNotifying:"bx",kShowPowerAlert:"by",kIdentifierKey:"bz",kScanOptionAllowDuplicatesKey:"b0",kScanOptionSolicitedServiceUUIDs:"b1",kAdvertisementDataKey:"b2",kCBAdvertisementDataManufacturerDataKey:"mfr",kCBAdvertisementDataServiceUUIDsKey:"suu",kCBAdvertisementDataServiceDataKey:"sdt",kCBAdvertisementDataOverflowServiceUUIDsKey:"b6",kCBAdvertisementDataSolicitedServiceUUIDsKey:"b7",kCBAdvertisementDataIsConnectable:"b8",kCBAdvertisementDataTxPowerLevel:"txp",kPeripheralBtAddress:"c1",kRawAdvertisementData:"c2",kScanRecord:"c3",kCBCentralManagerRestoredStatePeripheralsKey:"da",kCBCentralManagerRestoredStateScanServicesKey:"db",kWriteWithResponse:"cc",kWriteWithoutResponse:"cd",kNotifyOnConnection:"ce",kNotifyOnDisconnection:"cf",kNotifyOnNotification:"cg",kDisconnected:"ch",kConnecting:"ci",kConnected:"cj",kUnknown:"ck",kResetting:"cl",kUnsupported:"cm",kUnauthorized:"cn",kPoweredOff:"co",kPoweredOn:"cp",kErrorPeripheralNotFound:"-32001",kErrorServiceNotFound:"-32002",kErrorCharacteristicNotFound:"-32003",kErrorDescriptorNotFound:"-32004",kErrorPeripheralStateIsNotValid:"-32005",kErrorNoServiceSpecified:"-32006",kErrorNoPeripheralIdentiferSpecified:"-32007",kErrorStateRestorationNotValid:"-32008",kInvalidRequest:"-32600",kMethodNotFound:"-32601",kInvalidParams:"-32602",kError32603:"-32603",kParseError:"-32700",kGAP_ADTYPE_FLAGS:"01",kGAP_ADTYPE_INCOMPLETE_16BIT_SERVICEUUID:"02",kGAP_ADTYPE_COMPLETE_16BIT_SERVICEUUID:"03",kGAP_ADTYPE_INCOMPLETE_32BIT_SERVICEUUID:"04",kGAP_ADTYPE_COMPLETE_32BIT_SERVICEUUID:"05",kGAP_ADTYPE_INCOMPLETE_128BIT_SERVICEUUID:"06",kGAP_ADTYPE_COMPLETE_128BIT_SERVICEUUID:"07",kGAP_ADTYPE_POWER_LEVEL:"0A",kGAP_ADTYPE_MANUFACTURER_SPECIFIC:"FF",kGAP_ADTYPE_16BIT_SERVICE_DATA:"16",id:1,authenticate:"authenticate",kAuthenticate:"aut",kDeviceAccessToken:"dat",AllProperties:["Broadcast","Read","WriteWithoutResponse","Write","Notify","Indicate","AuthenticatedSignedWrites","ExtendedProperties","NotifyEncryptionRequired","IndicateEncryptionRequired"]};"object"==typeof process&&process+""=="[object process]"&&"undefined"!=typeof exports&&(exports.C=C),"object"==typeof process&&process+""=="[object process]"&&"undefined"!=typeof exports&&(exports.Descriptor=Descriptor),"object"==typeof process&&process+""=="[object process]"&&"undefined"!=typeof exports&&(exports.GattIpServer=GattIpServer),"object"==typeof process&&process+""=="[object process]"&&"undefined"!=typeof exports&&(exports.GATTIP=GATTIP),"object"==typeof process&&process+""=="[object process]"&&(module.exports.GATTIP=require("./gattip").GATTIP,module.exports.GattIpServer=require("./gattip-server").GattIpServer),"object"==typeof process&&process+""=="[object process]"&&"undefined"!=typeof exports&&(exports.Peripheral=Peripheral),"object"==typeof process&&process+""=="[object process]"&&"undefined"!=typeof exports&&(exports.Service=Service);
/* blueapp.io v0.0.1 */
!function e(t,r,i){function a(n,o){if(!r[n]){if(!t[n]){var c="function"==typeof require&&require;if(!o&&c)return c(n,!0);if(s)return s(n,!0);var u=new Error("Cannot find module '"+n+"'");throw u.code="MODULE_NOT_FOUND",u}var p=r[n]={exports:{}};t[n][0].call(p.exports,function(e){var r=t[n][1][e];return a(r?r:e)},p,p.exports,e,t,r,i)}return r[n].exports}for(var s="function"==typeof require&&require,n=0;n<i.length;n++)a(i[n]);return a}({1:[function(e,t,r){for(var i,a=/\+/g,s=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(a," "))},o=window.location.search.substring(1),c={};i=s.exec(o);)c[n(i[1])]=n(i[2]);var u=c.token,p=c.uuid,h=c.proxyUrl,l=function(){function t(e){}return"object"!=typeof window.bawb&&(window.bawb=e("blueapp-wb").init({GATTIP:GATTIP,url:h,gatewayToken:u,deviceUUID:p,onError:t}).navigator.bluetooth),window.bawb};if("object"==typeof window&&"object"==typeof navigator){u&&(Object.defineProperty?Object.defineProperty(navigator,"bluetooth",{get:l}):Object.prototype.__defineGetter__&&navigator.__defineGetter__("bluetooth",l));navigator.bluetooth}},{"blueapp-wb":3}],2:[function(e,t,r){var i=e("events"),a=e("util");t.exports.makeEmitter=function(e){a.inherits(e,i)},t.exports.instantiateEmitter=function(e){i.call(e)}},{events:18,util:22}],3:[function(e,t,r){"use strict";function i(e){this.gateway=e,this.isReady=!1}var a=e("./util.js"),s=e("./thirdparty"),n=e("./wb-device").BluetoothDevice;t.exports.navigator=void 0,t.exports.window=void 0,i.prototype.requestDevice=function(e){var t=(e.filters,this.gateway),r=this;return a.errorLoggingPromise(function(e,t){r.isReady?e():r.onReady=function(){e(),r.onReady=function(){}}}).then(function(){return a.errorLoggingPromise(function(e,r){var i=setTimeout(function(){r("Timed out")},3e4);t.onscan=function(r){if(void 0!=r){clearTimeout(i),t.stopScan();var a=new n(t,r);e(a),t.onscan=function(){}}},t.scan()})})},t.exports.init=function(t){var r={};r.bluetooth={},r.BluetoothUUID=s.BluetoothUUID,t||(t={}),"function"!=typeof t.GATTIP&&(t.GATTIP=e("gatt-ip").GATTIP);var a=new t.GATTIP;a.BluetoothUUID=s.BluetoothUUID;var n={};n.bluetooth=new i(a);var o="localhost",c=6001;return t.gatewayToken?(n.bluetooth.referringDevice={dummy:"this is a dummy device",id:t.deviceUUID},a.init(t.url),a.oninit=function(e,r){var i={type:"authenticate",access_token:t.gatewayToken};a.send(JSON.stringify(i))},a.onauthenticate=function(e,t){if(e.isAuthenticated===!0)a.configure(!0);else{if("function"!=typeof r)var r=console.error;a.close()}}):(a.init("ws://"+o+":"+c),a.oninit=function(e,t){a.configure(!0)}),a.onconfigure=function(e,t){a.centralState()},a.ondisconnect||(a.ondisconnect=function(){}),a.origScan=a.scan,a.scan=function(e,r,i){var s=a.onscan;a.origScan(e,r,function(e,r){e&&(t.deviceUUID?e.uuid===t.deviceUUID&&s(e,r):s(e,r))})},a.onerror=function(e){t.onError&&t.onError(e)},a.onstate=function(e){return a.state===C.kPoweredOn?(t.onReady&&t.onReady(),n.bluetooth.onReady&&n.bluetooth.onReady(),void(n.bluetooth.isReady=!0)):(a.state===C.kPoweredOff||a.state===C.kUnsupported,void a.centralState())},a.onupdateValue=function(e,t,r,i){},a.onwriteValue=function(e,t,r,i){},{navigator:n,window:r}}},{"./thirdparty":12,"./util.js":13,"./wb-device":16,"gatt-ip":9}],4:[function(e,t,r){(function(t){function i(r,i,a,s){function n(e,t){params={},params[C.kPeripheralUUID]=c.uuid,params[C.kServiceUUID]=u.uuid,params[C.kCharacteristicUUID]=t.uuid,params[C.kIsNotifying]=t.isNotifying,params[C.kValue]=t.value,o.write(C.kSetValueNotification,params,e)}"object"==typeof t&&t+""=="[object process]"&&(C=e("./constants.js").C,Descriptor=e("./descriptor.js").Descriptor);var o=r,c=i,u=a;if(this.uuid=s,this.descriptors={},this.properties={},this.value="",this.characteristicName="",this.isNotifying=!1,Object.size=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r},i.characteristicNames&&i.characteristicNames[s]){var p=i.characteristicNames[s];void 0!==p&&null!==p&&(this.characteristicName=p.name)}this.discoverDescriptors=function(e){if(e&&(this.ondiscoverDescriptors=e),this.descriptors&&Object.size(this.descriptors)>0)o.ondiscoverDescriptors(c,u,this);else{var t={};t[C.kPeripheralUUID]=c.uuid,t[C.kServiceUUID]=u.uuid,t[C.kCharacteristicUUID]=this.uuid,o.write(C.kGetDescriptors,t)}},this.ondiscoverDescriptors=function(e){if("undefined"!=typeof e)for(var t in e[C.kDescriptors]){var r=e[C.kDescriptors][t][C.kDescriptorUUID],i=this.descriptors[r];i||(i=new Descriptor(o,c,u,this,r));var a=e[C.kDescriptors][t][C.kProperties];for(var s in C.AllProperties)i.properties[C.AllProperties[s]]={enabled:a>>s&1,name:C.AllProperties[s]};this.descriptors[r]=i}},this.read=function(e){e&&(this.onread=e);var t={};t[C.kPeripheralUUID]=c.uuid,t[C.kServiceUUID]=u.uuid,t[C.kCharacteristicUUID]=this.uuid,o.write(C.kGetCharacteristicValue,t)},this.onread=function(e){this.isNotifying=e[C.kIsNotifying],this.value=e[C.kValue]},this.write=function(e,t){var r;r=1==this.properties.WriteWithoutResponse.enabled||1==this.properties.Indicate.enabled?C.kWriteWithoutResponse:C.kWriteResponse,this.writeWithResType(e,r,t)},this.writeWithResType=function(e,t,r){r&&(this.onwrite=r);var i={};i[C.kPeripheralUUID]=c.uuid,i[C.kServiceUUID]=u.uuid,i[C.kCharacteristicUUID]=this.uuid,i[C.kValue]=e,i[C.kWriteType]=t,o.write(C.kWriteCharacteristicValue,i)},this.onwrite=function(e,t){},this.notify=function(e,t){t&&(this.onread=t);var r={};r[C.kPeripheralUUID]=c.uuid,r[C.kServiceUUID]=u.uuid,r[C.kCharacteristicUUID]=this.uuid,r[C.kValue]=e,r[C.kIsNotifying]=e,this.isNotifying=e,o.write(C.kSetValueNotification,r)},this.indicate=function(e){e&&(this.onread=e);var t={};t[C.kPeripheralUUID]=c.uuid,t[C.kServiceUUID]=u.uuid,t[C.kCharacteristicUUID]=this.uuid,o.write(C.kGetCharacteristicValue,t)},this.broadcast=function(e){e&&(this.onread=e);var t={};t[C.kPeripheralUUID]=c.uuid,t[C.kServiceUUID]=u.uuid,t[C.kCharacteristicUUID]=this.uuid,o.write(C.kGetCharacteristicValue,t)},this.discoverDescriptorsRequest=function(e){if(!o.discoverDescriptorsRequest)throw Error("discoverDescriptorsRequest method not implemented by server");o.discoverDescriptorsRequest(e,c,u,this)},this.discoverDescriptorsResponse=function(e,t){if(t)o.sendErrorResponse(e,C.kGetCharacteristics,kError32603,t);else{params={};var r=[];for(var i in this.descriptors){var a={};a[C.kDescriptorUUID]=this.descriptors[i].uuid,a[C.kProperties]=this.descriptors[i].properties,a[C.kValue]=this.descriptors[i].value,a[C.kIsNotifying]=this.descriptors[i].isNotifying,r.push(a)}params[C.kDescriptors]=r,params[C.kPeripheralUUID]=c.uuid,params[C.kServiceUUID]=u.uuid,params[C.kCharacteristicUUID]=this.uuid,o.write(C.kGetDescriptors,params,e)}},this.readCharacteristicValueRequest=function(e,t){if(!o.readCharacteristicValueRequest)throw Error("readCharacteristicValueRequest method not implemented by server");o.readCharacteristicValueRequest(e,c,u,this)},this.writeCharacteristicValueRequest=function(e,t){if(!o.writeCharacteristicValueRequest)throw Error("writeCharacteristicValueRequest method not implemented by server");o.writeCharacteristicValueRequest(e,c,u,this,t[C.kValue])},this.enableNotificationsRequest=function(e,t){if(!o.enableNotificationsRequest)throw Error("enableNotificationsRequest method not implemented by server");o.enableNotificationsRequest(e,c,u,this,t[C.kIsNotifying])},this.respondToReadRequest=function(e,t){t?this.sendErrorResponse(e,C.kGetCharacteristicValue,C.kError32603,"Failed to read the Characteristic value"):(params={},params[C.kPeripheralUUID]=c.uuid,params[C.kServiceUUID]=u.uuid,params[C.kCharacteristicUUID]=this.uuid,params[C.kValue]=this.value,params[C.kIsNotifying]=this.isNotifying,o.write(C.kGetCharacteristicValue,params,e))},this.respondToWriteRequest=function(e,t){t?this.sendErrorResponse(e,C.kWriteCharacteristicValue,C.kError32603,"Failed to write the Characteristic value"):(params={},params[C.kPeripheralUUID]=c.uuid,params[C.kServiceUUID]=u.uuid,params[C.kCharacteristicUUID]=this.uuid,params[C.kValue]=this.value,o.write(C.kWriteCharacteristicValue,params,e))},this.respondWithNotification=function(e,t){this.value=t,n(e,this)},this.respondToChangeNotification=function(e,t){this.isNotifying=t,n(e,this)},this.addDescriptor=function(e){var t=new Descriptor(o,c,u,this,e);return this.descriptors[t.uuid]=t,t},this.updateValue=function(e){return this.value=e,this},this.updateProperties=function(e){return this.properties=e,this}}"object"==typeof t&&t+""=="[object process]"&&"undefined"!=typeof r&&(r.Characteristic=i)}).call(this,e("_process"))},{"./constants.js":5,"./descriptor.js":6,_process:20}],5:[function(e,t,r){(function(e){var t={kError:"error",kCode:"code",kMessageField:"message",kMethod:"method",kResult:"result",kIdField:"id",kSessionIdField:"session_id",kConfigure:"aa",kScanForPeripherals:"ab",kStopScanning:"ac",kConnect:"ad",kDisconnect:"ae",kCentralState:"af",kGetConnectedPeripherals:"ag",kGetPerhipheralsWithServices:"ah",kGetPerhipheralsWithIdentifiers:"ai",kGetServices:"ak",kGetIncludedServices:"al",kGetCharacteristics:"am",kGetDescriptors:"an",kGetCharacteristicValue:"ao",kGetDescriptorValue:"ap",kWriteCharacteristicValue:"aq",kWriteDescriptorValue:"ar",kSetValueNotification:"as",kGetPeripheralState:"at",kGetRSSI:"au",kInvalidatedServices:"av",kPeripheralNameUpdate:"aw",kMessage:"zz",kCentralUUID:"ba",kPeripheralUUID:"bb",kPeripheralName:"bc",kPeripheralUUIDs:"bd",kServiceUUID:"be",kServiceUUIDs:"bf",kPeripherals:"bg",kIncludedServiceUUIDs:"bh",kCharacteristicUUID:"bi",kCharacteristicUUIDs:"bj",kDescriptorUUID:"bk",kServices:"bl",kCharacteristics:"bm",kDescriptors:"bn",kProperties:"bo",kValue:"bp",kState:"bq",kStateInfo:"br",kStateField:"bs",kWriteType:"bt",kRSSIkey:"bu",kIsPrimaryKey:"bv",kIsBroadcasted:"bw",kIsNotifying:"bx",kShowPowerAlert:"by",kIdentifierKey:"bz",kScanOptionAllowDuplicatesKey:"b0",kScanOptionSolicitedServiceUUIDs:"b1",kAdvertisementDataKey:"b2",kCBAdvertisementDataManufacturerDataKey:"mfr",kCBAdvertisementDataServiceUUIDsKey:"suu",kCBAdvertisementDataServiceDataKey:"sdt",kCBAdvertisementDataOverflowServiceUUIDsKey:"b6",kCBAdvertisementDataSolicitedServiceUUIDsKey:"b7",kCBAdvertisementDataIsConnectable:"b8",kCBAdvertisementDataTxPowerLevel:"txp",kPeripheralBtAddress:"c1",kRawAdvertisementData:"c2",kScanRecord:"c3",kCBCentralManagerRestoredStatePeripheralsKey:"da",kCBCentralManagerRestoredStateScanServicesKey:"db",kWriteWithResponse:"cc",kWriteWithoutResponse:"cd",kNotifyOnConnection:"ce",kNotifyOnDisconnection:"cf",kNotifyOnNotification:"cg",kDisconnected:"ch",kConnecting:"ci",kConnected:"cj",kUnknown:"ck",kResetting:"cl",kUnsupported:"cm",kUnauthorized:"cn",kPoweredOff:"co",kPoweredOn:"cp",kErrorPeripheralNotFound:"-32001",kErrorServiceNotFound:"-32002",kErrorCharacteristicNotFound:"-32003",kErrorDescriptorNotFound:"-32004",kErrorPeripheralStateIsNotValid:"-32005",kErrorNoServiceSpecified:"-32006",kErrorNoPeripheralIdentiferSpecified:"-32007",kErrorStateRestorationNotValid:"-32008",kInvalidRequest:"-32600",kMethodNotFound:"-32601",kInvalidParams:"-32602",kError32603:"-32603",kParseError:"-32700",kGAP_ADTYPE_FLAGS:"01",kGAP_ADTYPE_INCOMPLETE_16BIT_SERVICEUUID:"02",kGAP_ADTYPE_COMPLETE_16BIT_SERVICEUUID:"03",kGAP_ADTYPE_INCOMPLETE_32BIT_SERVICEUUID:"04",kGAP_ADTYPE_COMPLETE_32BIT_SERVICEUUID:"05",kGAP_ADTYPE_INCOMPLETE_128BIT_SERVICEUUID:"06",kGAP_ADTYPE_COMPLETE_128BIT_SERVICEUUID:"07",kGAP_ADTYPE_POWER_LEVEL:"0A",kGAP_ADTYPE_MANUFACTURER_SPECIFIC:"FF",kGAP_ADTYPE_16BIT_SERVICE_DATA:"16",id:1,authenticate:"authenticate",kAuthenticate:"aut",kDeviceAccessToken:"dat",AllProperties:["Broadcast","Read","WriteWithoutResponse","Write","Notify","Indicate","AuthenticatedSignedWrites","ExtendedProperties","NotifyEncryptionRequired","IndicateEncryptionRequired"]};"object"==typeof e&&e+""=="[object process]"&&"undefined"!=typeof r&&(r.C=t)}).call(this,e("_process"))},{_process:20}],6:[function(e,t,r){(function(e){function t(e,t,r,i,a){var s=e,n=t,o=r,c=i;if(this.uuid=a,this.value="",this.descriptorName="",this.properties={},this.isNotifying=!1,t.descriptorNames&&t.descriptorNames[a]){var u=t.descriptorNames[a];void 0!==u&&null!==u&&(this.descriptorName=u.name)}this.updateValue=function(e){return this.value=e,this},this.updateProperties=function(e){return this.properties=e,this},this.read=function(e){e&&(this.onread=e);var t={};t[C.kPeripheralUUID]=n.uuid,t[C.kServiceUUID]=o.uuid,t[C.kCharacteristicUUID]=c.uuid,t[C.kDescriptorUUID]=this.uuid,s.write(C.kGetDescriptorValue,t)},this.onread=function(e){this.isNotifying=e[C.kIsNotifying],this.value=e[C.kValue]},this.write=function(e,t){t&&(this.onwrite=t);var r={};r[C.kPeripheralUUID]=n.uuid,r[C.kServiceUUID]=o.uuid,r[C.kCharacteristicUUID]=c.uuid,r[C.kDescriptorUUID]=this.uuid,r[C.kValue]=e,s.write(C.kWriteDescriptorValue,r)},this.onwrite=function(e){},this.readDescriptorValueRequest=function(e,t){if(!s.readDescriptorValueRequest)throw Error("readDescriptorValueRequest method not implemented by server");s.readDescriptorValueRequest(e,n,o,c,this)},this.writeDescriptorValueRequest=function(e,t){if(!s.writeDescriptorValueRequest)throw Error("writeDescriptorValueRequest method not implemented by server");s.writeDescriptorValueRequest(e,n,o,c,this,t[C.kValue])},this.respondToReadDescriptorValueRequest=function(e,t){t?this.sendErrorResponse(e,C.kGetDescriptorValue,C.kError32603,"Failed to read the descriptor value"):(params={},params[C.kPeripheralUUID]=n.uuid,params[C.kServiceUUID]=o.uuid,params[C.kCharacteristicUUID]=c.uuid,params[C.kDescriptorUUID]=this.uuid,params[C.kValue]=this.value,params[C.kIsNotifying]=this.isNotifying,s.write(C.kGetDescriptorValue,params,e))},this.respondToWriteDescriptorValueRequest=function(e,t){t?this.sendErrorResponse(e,C.kWriteDescriptorValue,C.kError32603,"Failed to write the descriptor value"):(params={},params[C.kPeripheralUUID]=n.uuid,params[C.kServiceUUID]=o.uuid,params[C.kCharacteristicUUID]=c.uuid,params[C.kDescriptorUUID]=this.uuid,params[C.kValue]=this.value,s.write(C.kWriteDescriptorValue,params,e))}}"object"==typeof e&&e+""=="[object process]"&&"undefined"!=typeof r&&(r.Descriptor=t)}).call(this,e("_process"))},{_process:20}],7:[function(e,t,r){(function(t){function i(){function r(e,t){var r=t?"0x":"";for(var i in e){var a=(255&e[i]).toString(16);1==a.length&&(a="0"+a),r+=a}return r}function i(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}function a(e){var t={};if(e&&e.services)for(var r in e.services){var i={};i[C.kServiceUUID]=r,i[C.kIsPrimaryKey]=e.services[r].isPrimary,i[C.kCharacteristics]=s(e.services[r]),t[r]=i}return t}function s(e){var t={};if(e&&e.characteristics)for(var r in e.characteristics){var i={};i[C.kCharacteristicUUID]=r,i[C.kValue]=e.characteristics[r].value,i[C.kProperties]=e.characteristics[r].properties,i[C.kIsNotifying]=e.characteristics[r].isNotifying,i[C.kDescriptors]=n(e.characteristics[r]),t[r]=i}return t}function n(e){var t={};if(e&&e.descriptors)for(var r in e.descriptors){var i={};i[C.kDescriptorUUID]=r,i[C.kValue]=e.descriptors[r].value,i[C.kProperties]=e.descriptors[r].properties,i[C.kIsNotifying]=e.descriptors[r].isNotifying,t[r]=i}return t}"object"==typeof t&&t+""=="[object process]"&&(C=e("./constants.js").C,Peripheral=e("./peripheral.js").Peripheral,WebSocket=e("websocket").w3cwebsocket);var o;this.state=C.kUnknown,this.peripherals={},this.init=function(e,t){t&&(this.oninit=t),this.socket=new WebSocket(e),this.socket.onopen=function(){this.initWithServer(this.socket),this.oninit&&this.oninit()}.bind(this)},this.initWithServer=function(e){if(o=e,!o.send)throw Error("server must implement the send method");o.onmessage=this.processMessage.bind(this),o.onclose||(o.onclose=function(){}),o.onerror||(o.onerror=function(e){}),o.error||(o.onerror=function(e){})},this.processMessage=function(e){var t,r,i=JSON.parse(e.data);if("undefined"==typeof i||!i)return t={},t[C.kCode]=C.kInvalidRequest,void this.write(C.kError,t);if(i.result&&(i.result==C.kMessage||i.result==C.authenticate))return void this.onauthenticate(i.params,i.error);if(i.error)return void this.sendErrorResponse(void 0,i.method,C.kInvalidRequest,"Error in the Request");var a={id:i.id,session_id:i.session_id};switch(i.method){case C.kConfigure:this.configureRequest(a,i.params);break;case C.kScanForPeripherals:this.scanRequest(a,i.params[C.kScanOptionAllowDuplicatesKey],i.params[C.kServiceUUIDs]);break;case C.kStopScanning:this.stopScanRequest(a,i.params);break;case C.kConnect:try{r=this.getObjects(a,"P",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),this.connectRequest(a,r.peripheral)}catch(s){}break;case C.kDisconnect:try{r=this.getObjects(a,"P",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),this.disconnectRequest(a,r.peripheral)}catch(s){}break;case C.kCentralState:this.centralStateRequest(a,i.params);break;case C.kGetServices:try{r=this.getObjects(a,"P",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),r.peripheral.discoverServicesRequest(a)}catch(s){}break;case C.kGetIncludedServices:break;case C.kInvalidatedServices:break;case C.kGetCharacteristics:try{r=this.getObjects(a,"S",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),r.service.discoverCharacteristicsRequest(a)}catch(s){}break;case C.kGetDescriptors:try{r=this.getObjects(a,"C",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),r.characteristic.discoverDescriptorsRequest(a)}catch(s){}break;case C.kGetCharacteristicValue:try{r=this.getObjects(a,"C",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),r.characteristic.readCharacteristicValueRequest(a,i.params)}catch(s){}break;case C.kWriteCharacteristicValue:try{r=this.getObjects(a,"C",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),r.characteristic.writeCharacteristicValueRequest(a,i.params)}catch(s){}break;case C.kSetValueNotification:try{r=this.getObjects(a,"C",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),r.characteristic.isNotifying=i.params[C.kValue],r.characteristic.enableNotificationsRequest(a,i.params)}catch(s){}break;case C.kGetDescriptorValue:try{r=this.getObjects(a,"D",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),r.descriptor.readDescriptorValueRequest(a,i.params)}catch(s){}break;case C.kWriteDescriptorValue:try{r=this.getObjects(a,"D",i.params[C.kPeripheralUUID],i.params[C.kServiceUUID],i.params[C.kCharacteristicUUID],i.params[C.kDescriptorUUID]),r.descriptor.writeDescriptorValueRequest(a,i.params)}catch(s){}break;default:return void this.sendErrorResponse(a,i.method,C.kInvalidRequest,"Request not handled by server")}this.message=i},this.getObjects=function(e,t,r,i,a,s){var n={};if(n.peripheral=this.peripherals[r],n.peripheral){if("P"===t)return n;if(n.service=n.peripheral.services[i],n.service){if("S"===t)return n;if(n.characteristic=n.service.characteristics[a],n.characteristic){if("C"===t)return n;if(n.descriptor=n.characteristic.descriptors[s],n.descriptor)return n;throw this.sendErrorResponse(e,message.method,C.kErrorDescriptorNotFound,"Descriptor not found"),Error("Descriptor not found")}throw this.sendErrorResponse(e,message.method,C.kErrorCharacteristicNotFound,"Characteristic not found"),Error("Characteristic not found")}throw this.sendErrorResponse(e,message.method,C.kErrorServiceNotFound,"Service not found"),Error("Service not found")}throw this.sendErrorResponse(e,message.method,C.kErrorPeripheralNotFound,"Peripheral not found"),Error("Peripheral not found")},this.sendErrorResponse=function(e,t,r,i){var a={};params={},a[C.kCode]=r,a[C.kMessageField]=i,params[C.kError]=a,this.write(t,void 0,e,a)},this.authenticate=function(e){params={},params[C.kDeviceAccessToken]=e;var t={};t.method=C.kAuthenticate,t.params=params,t.id=C.id.toString(),C.id+=1,this.send(JSON.stringify(t))},this.configureRequest=function(){},this.configureResponse=function(e,t){t?this.sendErrorResponse(e,C.kConfigure,t):this.write(C.kConfigure,void 0,e)},this.centralStateRequest=function(){},this.centralStateResponse=function(e,t,r){r?this.write(C.kCentralState,params,e,r):(params={},params[C.kState]=t,this.write(C.kCentralState,params,e))},this.scanRequest=function(){},this.scanResponse=function(e,t,a,s,n,o,c,u,p){params={};var h,l;if(!i(u)){h={};for(var d in u){var f=d.toUpperCase();h[f]=r(u[d]).toUpperCase()}}if(!i(p)){l={};for(var v in p){var m=v.toUpperCase();l[m]=r(p[v]).toUpperCase()}}params[C.kPeripheralName]=t,params[C.kPeripheralUUID]=a,params[C.kPeripheralBtAddress]=s,params[C.kRSSIkey]=n,params[C.kCBAdvertisementDataTxPowerLevel]=o,params[C.kCBAdvertisementDataServiceUUIDsKey]=c&&c.length>0?c:void 0,params[C.kCBAdvertisementDataManufacturerDataKey]=h,params[C.kCBAdvertisementDataServiceDataKey]=l,this.write(C.kScanForPeripherals,params,e)},this.stopScanRequest=function(){},this.stopScanResponse=function(e,t){t?this.sendErrorResponse(e,C.kStopScanning,t):this.write(C.kStopScanning,void 0,e)},this.connectRequest=function(){},this.connectResponse=function(e,t,r){var i={};i[C.kPeripheralUUID]=t.uuid,i[C.kPeripheralName]=t.name;var s={};s=a(t),i[C.kServices]=s,r?this.sendErrorResponse(e,C.kConnect,r):this.write(C.kConnect,i,e)},this.disconnectRequest=function(){},this.disconnectResponse=function(e,t){t?this.write(C.kDisconnect,t):(params={},params[C.kPeripheralUUID]=e.uuid,params[C.kPeripheralName]=e.name,this.write(C.kDisconnect,params))},this.write=function(e,t,r,i){var a={};a.jsonrpc="2.0",a.result=e,a.params=t,a.error=i,r&&(a.id=r.id,a.session_id=r.session_id),this.send(JSON.stringify(a))},this.send=function(e){return o?void(1===o.readyState&&o.send(e)):void this.onerror("not connected")},this.close=function(e){o&&o.close()},this.addPeripheral=function(e,t,r,i,a,s,n,o){var c=new Peripheral(this,e,t,r,i,a,s,n,o);return this.peripherals[c.uuid]=c,c},this.GATM_SECURITY_PROPERTIES_NO_SECURITY=0,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_ENCRYPTION_WRITE=1,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_ENCRYPTION_WRITE=2,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_ENCRYPTION_READ=4,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_ENCRYPTION_READ=8,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_SIGNED_WRITES=16,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_SIGNED_WRITES=32,this.GATM_CHARACTERISTIC_PROPERTIES_BROADCAST=1,this.GATM_CHARACTERISTIC_PROPERTIES_READ=2,this.GATM_CHARACTERISTIC_PROPERTIES_WRITE_WO_RESP=4,this.GATM_CHARACTERISTIC_PROPERTIES_WRITE=8,this.GATM_CHARACTERISTIC_PROPERTIES_NOTIFY=16,this.GATM_CHARACTERISTIC_PROPERTIES_INDICATE=32,this.GATM_CHARACTERISTIC_PROPERTIES_AUTHENTICATED_SIGNED_WRITES=64,this.GATM_CHARACTERISTIC_PROPERTIES_EXT_PROPERTIES=128,this.GATM_DESCRIPTOR_PROPERTIES_READ=1,this.GATM_DESCRIPTOR_PROPERTIES_WRITE=2}"object"==typeof t&&t+""=="[object process]"&&"undefined"!=typeof r&&(r.GattIpServer=i)}).call(this,e("_process"))},{"./constants.js":5,"./peripheral.js":10,_process:20,websocket:23}],8:[function(e,t,r){(function(t){function i(){"object"==typeof t&&t+""=="[object process]"&&(C=e("./constants.js").C,Peripheral=e("./peripheral.js").Peripheral,WebSocket=e("websocket").w3cwebsocket);var r;this.peripherals={},this.init=function(e,t){t&&(this.oninit=t),this.socket=new WebSocket(e),this.socket.onopen=function(){this.initWithClient(this.socket),this.oninit&&this.oninit()}.bind(this)},this.initWithClient=function(e){this.state=C.kUnknown,r=e,r.onmessage=this.processMessage.bind(this)},this.processMessage=function(e){var t,r,i,a=JSON.parse(e.data),s={};switch(a.result){case C.kConfigure:this.onconfigure(a.params,a.error);break;case C.kScanForPeripherals:a.params&&a.params[C.kPeripheralUUID]&&(t=this.peripherals[a.params[C.kPeripheralUUID]]),t?t.updatePeripheral(a.params[C.kPeripheralName],a.params[C.kPeripheralBtAddress],a.params[C.kRSSIkey],a.params[C.kCBAdvertisementDataTxPowerLevel],a.params[C.kCBAdvertisementDataServiceUUIDsKey],a.params[C.kCBAdvertisementDataManufacturerDataKey],a.params[C.kCBAdvertisementDataServiceDataKey],a.params[C.kAdvertisementDataKey],a.params[C.kScanRecord]):(t=new Peripheral(this,a.params[C.kPeripheralName],a.params[C.kPeripheralUUID],a.params[C.kPeripheralBtAddress],a.params[C.kRSSIkey],a.params[C.kCBAdvertisementDataTxPowerLevel],a.params[C.kCBAdvertisementDataServiceUUIDsKey],a.params[C.kCBAdvertisementDataManufacturerDataKey],a.params[C.kCBAdvertisementDataServiceDataKey],a.params[C.kAdvertisementDataKey],a.params[C.kScanRecord]),this.peripherals[a.params[C.kPeripheralUUID]]=t),this.onscan(t,a.error);break;case C.kStopScanning:this.onstopScan(a.error);break;case C.kConnect:if(a.params&&a.params[C.kPeripheralUUID]&&(t=this.peripherals[a.params[C.kPeripheralUUID]]),a.error)t&&t.onconnect(a.error);else if(t){t.ondiscoverServices(a.params,a.error);for(var n in a.params[C.kServices])if(r=t.services[n]){r.ondiscoverCharacteristics(a.params[C.kServices][n],a.error);for(var o in r.characteristics)i=r.characteristics[o],i?i.ondiscoverDescriptors(a.params[C.kServices][r.uuid][C.kCharacteristics][o],a.error):this.onerror("Characteristic not found")}else this.onerror("Service not found");t.onconnect()}else this.onerror("Peripheral not found");this.onconnect(t,a.error);break;case C.kDisconnect:a.params&&(s=this.getObjects("P",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.peripheral&&s.peripheral.ondisconnect(a.error)),this.ondisconnect(s.peripheral,a.error);break;case C.kCentralState:this.state=a.params[C.kState],this.onstate(a.params[C.kState],a.error);break;case C.kGetServices:a.params&&(s=this.getObjects("P",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.peripheral&&s.peripheral.ondiscoverServices(a.params,a.error)),this.ondiscoverServices(s.peripheral,a.error);break;case C.kGetCharacteristics:a.params&&(s=this.getObjects("S",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.service&&s.service.ondiscoverCharacteristics(a.params,a.error)),this.ondiscoverCharacteristics(s.peripheral,s.service,a.error);break;case C.kGetDescriptors:a.params&&(s=this.getObjects("C",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.characteristic&&s.characteristic.ondiscoverDescriptors(a.params,a.error)),this.ondiscoverDescriptors(s.peripheral,s.service,s.characteristic,a.error);break;case C.kGetCharacteristicValue:a.params&&(s=this.getObjects("C",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.characteristic&&s.characteristic.onread(a.params,a.error)),this.onupdateValue(s.peripheral,s.service,s.characteristic,a.error);break;case C.kWriteCharacteristicValue:a.params&&(s=this.getObjects("C",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.characteristic&&s.characteristic.onwrite(a.params,a.error)),this.onwriteValue(s.peripheral,s.service,s.characteristic,a.error);break;case C.kSetValueNotification:a.params&&(s=this.getObjects("C",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.characteristic&&(s.characteristic.isNotifying=a.params[C.kIsNotifying],s.characteristic.value=a.params[C.kValue])),this.onupdateValue(s.peripheral,s.service,s.characteristic,a.error);break;case C.kGetDescriptorValue:a.params&&(s=this.getObjects("D",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.descriptor&&s.descriptor.onread(a.params,a.error)),this.ondescriptorRead(s.peripheral,s.service,s.characteristic,s.descriptor,a.error);break;case C.kWriteDescriptorValue:a.params&&(s=this.getObjects("D",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.descriptor&&s.descriptor.onwrite(a.params,a.error)),this.ondescriptorWrite(s.peripheral,s.service,s.characteristic,s.descriptor,a.error);break;case C.kGetRSSI:a.params&&(s=this.getObjects("P",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.peripheral&&(s.peripheral.name=a.params[C.kPeripheralName],s.peripheral.rssi=a.params[C.kRSSIkey])),this.onupdateRSSI(s.peripheral,a.error);break;case C.kPeripheralNameUpdate:a.params&&(s=this.getObjects("P",a.params[C.kPeripheralUUID],a.params[C.kServiceUUID],a.params[C.kCharacteristicUUID],a.params[C.kDescriptorUUID]),s.peripheral&&(s.peripheral.name=a.params[C.kPeripheralName],s.peripheral.rssi=a.params[C.kRSSIkey])),this.onupdateRSSI(s.peripheral,a.error);break;case C.kAuthenticate:case C.kMessage:this.onauthenticate(a.params,a.error);break;default:this.onerror("invalid response"),this.message=a}},this.getObjects=function(e,t,r,i,a){var s={};if(s.peripheral=this.peripherals[t],s.peripheral){if("P"===e)return s;if(s.service=s.peripheral.services[r],s.service){if("S"===e)return s;if(s.characteristic=s.service.characteristics[i],s.characteristic){if("C"===e)return s;if(s.descriptor=s.characteristic.descriptors[a],s.descriptor){if("D"===e)return s}else this.onerror("Descriptor not found")}else this.onerror("Characteristic not found")}else this.onerror("Service not found")}else this.onerror("Peripheral not found");return s},this.oninit=function(e){},this.authenticate=function(e){params={},params[C.kDeviceAccessToken]=e;var t={};t.method=C.kAuthenticate,t.params=params,t.id=C.id.toString(),C.id+=1,this.send(JSON.stringify(t))},this.configure=function(e,t,r){r&&(this.onconfigure=r);var i={};i[C.kShowPowerAlert]=e,i[C.kIdentifierKey]=t,this.write(C.kConfigure,i)},this.onconfigure=function(e){},this.scan=function(e,t,r){r&&(this.onscan=r),this.peripherals={};var i={};i[C.kScanOptionAllowDuplicatesKey]=e,i[C.kServiceUUIDs]=t,this.write(C.kScanForPeripherals,i)},this.onscan=function(e){},this.stopScan=function(e){e&&(this.onscan=e);var t={};this.write(C.kStopScanning,t)},this.onstopScan=function(e){},this.centralState=function(){var e={};this.write(C.kCentralState,e)},this.onstate=function(e){},this.onerror=function(e){},this.close=function(e){r&&r.close()},this.onclose=function(e,t){},this.onconnect=function(e){},this.ondisconnect=function(e){},this.ondiscoverServices=function(e){},this.ondiscoverCharacteristics=function(e){},this.ondiscoverDescriptors=function(e){},this.onupdateValue=function(e){},this.onwriteValue=function(e){},this.onupdateRSSI=function(e){},this.onMessage=function(e){},this.ondescriptorRead=function(e,t,r,i,a){},this.ondescriptorWrite=function(e,t,r,i,a){},this.write=function(e,t,r){var i={};i.jsonrpc="2.0",i.method=e,i.params=t,i.id=C.id.toString(),C.id+=1,this.send(JSON.stringify(i))},this.send=function(e){return r?void(1===r.readyState&&r.send(e)):void this.onerror("not connected")}}"object"==typeof t&&t+""=="[object process]"&&"undefined"!=typeof r&&(r.GATTIP=i)}).call(this,e("_process"))},{"./constants.js":5,"./peripheral.js":10,_process:20,websocket:23}],9:[function(e,t,r){(function(r){"object"==typeof r&&r+""=="[object process]"&&(t.exports.GATTIP=e("./gattip").GATTIP,t.exports.GattIpServer=e("./gattip-server").GattIpServer)}).call(this,e("_process"))},{"./gattip":8,"./gattip-server":7,_process:20}],10:[function(e,t,r){(function(t){function i(r,i,a,s,n,o,c,u,p,h,l){function d(e,t){return-1==e.indexOf(t)?(e.push(t),!0):!1}function f(e){var t=parseInt(e.advdata[0],16);parseInt(e.advdata[2],16)>=1?e.discoverable="true":e.discoverable="false",e.advdata.splice(0,t+1)}function v(e){
var t=parseInt(e.advdata[0],16);e.txpowerLevel=parseInt(e.advdata[2]),e.advdata.splice(0,t+1)}function m(e){var t=parseInt(e.advdata[0],16);if(t>2){for(var r=e.advdata[3]+e.advdata[2],i="",a=4;t>=a;a++)i+=e.advdata[a];e.manufacturerData[r]=i}e.advdata.splice(0,t+1)}function _(e){for(var t=parseInt(e.advdata[0],16),r="",i=t;i>=2;i--)r+=e.advdata[i];e.serviceUUIDs[0]=r,e.advdata.splice(0,t+1)}function k(e){for(var t=parseInt(e.advdata[0],16),r="",i=t;i>=2;i--)r+=e.advdata[i],14!=i&&12!=i&&10!=i&&8!=i||(r+="-");e.serviceUUIDs[0]=r,e.advdata.splice(0,t+1)}function g(e){for(var t=parseInt(e.advdata[0],16),r="",i=3;i>=2;i--)r+=e.advdata[i];"FEAA"==r&&(0===parseInt(e.advdata[4],16)?U(e):16==parseInt(e.advdata[4],16)?I(e):32==parseInt(e.advdata[4],16)&&D(e)),e.advdata.splice(0,t+1)}function U(e){e.frameType="UID",e.nameSpace="",e.instanceID="",e.txpowerLevel=parseInt(e.advdata[5],16);for(var t=6;16>t;t++)e.nameSpace+=e.advdata[t];for(var r=16;22>r;r++)e.instanceID+=e.advdata[r];e.reserved=e.advdata[22],e.reserved+=e.advdata[23]}function I(e){e.frameType="URL",e.txpowerLevel=parseInt(e.advdata[5]);for(var t in C.AllProtocols)advdata[6]==t&&(e.url=C.AllProtocols[t]);for(var r=7;r<advdataLength;r++)e.url+=String.fromCharCode(parseInt(e.advdata[r],16));for(var i in C.AllDomains)e.advdata[advdataLength]==i&&(e.url+=C.AllDomains[i])}function D(e){e.frameType="TLM",e.advPacketCount="",e.timeInterval="",e.batteryVoltage="",e.eddyVersion=parseInt(e.advdata[5],16);for(var t=6;8>t;t++)e.batteryVoltage+=e.advdata[t];e.batteryVoltage=parseInt(e.batteryVoltage,16),e.temperature=Math.ceil(parseInt(e.advdata[8],16)),e.temperature+=".";var r=Math.ceil(1/256*parseInt(e.advdata[9],16));r.length>2?e.temperature+=r.toString().substring(0,2):e.temperature+=r;for(var i=10;14>i;i++)e.advPacketCount+=e.advdata[i];e.advPacketCount=parseInt(e.advPacketCount,16);for(var a=14;18>a;a++)e.timeInterval+=e.advdata[a];if(e.timeInterval=Math.ceil(.1*parseInt(e.timeInterval,16)),e.timePeriod="",e.timeInterval>=60){var s=Math.floor(e.timeInterval/86400);s>0&&(e.timePeriod+=10>s?s+"day ":s+"days ",e.timeInterval-=24*s*60*60);var n=Math.floor(e.timeInterval/3600);n>0?(e.timePeriod+=10>n?"0"+n+":":n+":",e.timeInterval-=60*n*60):e.timePeriod+="00:";var o=Math.floor(e.timeInterval/60);o>0?(e.timePeriod+=10>o?"0"+o+":":o+":",e.timeInterval-=60*o,e.timePeriod+=e.timeInterval<10?"0"+e.timeInterval:e.timeInterval,e.timePeriod+=" secs",e.timeInterval=0):(e.timePeriod+="00:"+e.timeInterval,e.timeInterval=0)}else e.timeInterval>0&&e.timeInterval<60&&(e.timePeriod+=e.timeInterval<10?"00:00:0"+e.timeInterval:"00:00:"+e.timeInterval,e.timePeriod+=" secs")}"object"==typeof t&&t+""=="[object process]"&&(C=e("./constants.js").C,Service=e("./service.js").Service);var b=r;this.uuid=a,this.manufacturerData={},this.serviceData={},this.serviceUUIDs=[],this.services={},this.isConnected=!1;var y=this;this.serviceNames,this.characteristicNames,this.descriptorNames,Object.size=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r},this.updatePeripheral=function(e,t,r,i,a,s,n,o,c){this.init(e,t,r,i,a,s,n,o,c)},this.init=function(e,t,r,i,a,s,n,o,c){var u=!0;if(this.name=e,this.addr=t,this.rssi=r,this.txpowerLevel=i,this.advertisementData=o,this.scanData=c,o&&(this.rawAdvertisingData=o[C.kRawAdvertisementData]),this.advdata=new Array,"undefined"!=typeof this.rawAdvertisingData){if(this.rawAdvertisingData.length%2===0)for(var p=0;p<this.rawAdvertisingData.length;p+=2)this.advdata[p/2]=this.rawAdvertisingData.charAt(p)+this.rawAdvertisingData.charAt(p+1);else for(var h=0;h<this.rawAdvertisingData.length;h++)this.advdata[h]=this.rawAdvertisingData.charAt(2*h)+this.rawAdvertisingData.charAt(2*h+1);do{if(this.advdata[1]==C.kGAP_ADTYPE_FLAGS)f(this);else if(this.advdata[1]==C.kGAP_ADTYPE_POWER_LEVEL)v(this);else if(this.advdata[1]==C.kGAP_ADTYPE_INCOMPLETE_16BIT_SERVICEUUID||this.advdata[1]==C.kGAP_ADTYPE_COMPLETE_16BIT_SERVICEUUID)_(this);else if(this.advdata[1]==C.kGAP_ADTYPE_INCOMPLETE_32BIT_SERVICEUUID||this.advdata[1]==C.kGAP_ADTYPE_COMPLETE_32BIT_SERVICEUUID)_(this);else if(this.advdata[1]==C.kGAP_ADTYPE_INCOMPLETE_128BIT_SERVICEUUID||this.advdata[1]==C.kGAP_ADTYPE_COMPLETE_128BIT_SERVICEUUID)k(this);else if(this.advdata[1]==C.kGAP_ADTYPE_MANUFACTURER_SPECIFIC)m(this);else if(this.advdata[1]==C.kGAP_ADTYPE_16BIT_SERVICE_DATA)g(this);else if("00"==this.advdata[1])this.advdata.splice(0,1);else{var l=parseInt(this.advdata[0],16);this.advdata.splice(0,l+1)}0===this.advdata.length&&(u=!1)}while(u)}if("undefined"!=typeof s&&"[object Object]"===Object.prototype.toString.call(s))if(this.manufacturerData&&Object.size(this.manufacturerData)>0)for(var U in s)this.manufacturerData[U]=s[U];else this.manufacturerData=s;if("undefined"!=typeof n&&"[object Object]"===Object.prototype.toString.call(n))if(this.serviceData&&Object.size(this.serviceData)>0)for(var I in n)this.serviceData[I]=n[I];else this.serviceData=n;if("undefined"!=typeof a&&"[object Array]"===Object.prototype.toString.call(a))if(this.serviceUUIDs&&this.serviceUUIDs.length>0)for(var D=0;D<a.length;D++)d(this.serviceUUIDs,a[D]);else this.serviceUUIDs=a},this.init(i,s,n,o,c,u,p,h,l),this.getManufacturerDataById=function(e){if("number"==typeof e){e=""+Number(e).toString(16);for(var t="",r=e.length;4>r;r++)t+="0";e=t+e}return this.manufacturerData[e]},this.getServiceDataByUUID=function(e){return this.serviceData[e]},this.connect=function(e){e&&(this.onconnect=e);var t={};t[C.kPeripheralUUID]=y.uuid,b.write(C.kConnect,t)},this.onconnect=function(e){e||(this.isConnected=!0)},this.disconnect=function(e){e&&(this.onconnect=e);var t={};t[C.kPeripheralUUID]=this.uuid,b.write(C.kDisconnect,t)},this.ondisconnect=function(e){e||(this.isConnected=!1)},this.discoverServices=function(e){if(e&&(this.ondiscoverServices=e),this.services&&Object.size(this.services)>0)b.ondiscoverServices(this);else{var t={};t[C.kPeripheralUUID]=this.uuid,b.write(C.kGetServices,t)}},this.ondiscoverServices=function(e){for(var t in e[C.kServices]){var r=e[C.kServices][t][C.kServiceUUID],i=this.services[r];i||(i=new Service(b,this,r)),this.services[r]=i}},this.updateRSSI=function(e){e&&(this.onupdateRSSI=e);var t={};t[C.kPeripheralUUID]=this.uuid,b.write(C.kGetRSSI,t)},this.onupdateRSSI=function(e){},this.discoverServicesRequest=function(e){if(!b.discoverServicesRequest)throw Error("discoverServicesRequest method not implemented by server");b.discoverServicesRequest(e,this)},this.discoverServicesResponse=function(e,t){if(t)b.sendErrorResponse(e,C.kGetServices,kError32603,t);else{params={};var r=[];for(var i in this.services){var a={};a[C.kServiceUUID]=this.services[i].uuid,a[C.kIsPrimaryKey]=this.services[i].isPrimary,r.push(a)}params[C.kServices]=r,params[C.kPeripheralUUID]=this.uuid,b.write(C.kGetServices,params,e)}},this.addService=function(e){var t=new Service(b,this,e);return this.services[t.uuid]=t,t}}"object"==typeof t&&t+""=="[object process]"&&"undefined"!=typeof r&&(r.Peripheral=i)}).call(this,e("_process"))},{"./constants.js":5,"./service.js":11,_process:20}],11:[function(e,t,r){(function(t){function i(r,i,a){"object"==typeof t&&t+""=="[object process]"&&(C=e("./constants.js").C,Characteristic=e("./characteristic.js").Characteristic);var s=r,n=i;if(this.uuid=a,this.isPrimary=!0,this.characteristics={},this.includedServices={},this.serviceName="",Object.size=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r},i.serviceNames&&i.serviceNames[a]){var o=i.serviceNames[a];void 0!==o&&null!==o&&(this.serviceName=o.name)}this.discoverIncludedServices=function(e){},this.ondiscoverIncludedServices=function(e){},this.discoverCharacteristics=function(e){if(e&&(this.ondiscoverCharacteristics=e),this.characteristics&&Object.size(this.characteristics)>0)s.ondiscoverCharacteristics(n,this);else{var t={};t[C.kPeripheralUUID]=n.uuid,t[C.kServiceUUID]=this.uuid,s.write(C.kGetCharacteristics,t)}},this.ondiscoverCharacteristics=function(e){for(var t in e[C.kCharacteristics]){var r=e[C.kCharacteristics][t][C.kCharacteristicUUID],i=this.characteristics[r];i||(i=new Characteristic(s,n,this,r)),this.characteristics[r]=i,i.value=e[C.kCharacteristics][t][C.kValue];var a=e[C.kCharacteristics][t][C.kProperties];for(var o in C.AllProperties)i.properties[C.AllProperties[o]]={enabled:a>>o&1,name:C.AllProperties[o]};i.isNotifying=e[C.kCharacteristics][t][C.kIsNotifying]}},this.discoverCharacteristicsRequest=function(e){if(!s.discoverCharacteristicsRequest)throw Error("discoverCharacteristicsRequest method not implemented by server");s.discoverCharacteristicsRequest(e,n,this)},this.discoverCharacteristicsResponse=function(e,t){if(t)s.sendErrorResponse(e,C.kGetCharacteristics,kError32603,t);else{params={};var r=[];for(var i in this.characteristics){var a={};a[C.kCharacteristicUUID]=this.characteristics[i].uuid,a[C.kProperties]=this.characteristics[i].properties?this.characteristics[i].properties:"",a[C.kValue]=this.characteristics[i].value,a[C.kIsNotifying]=this.characteristics[i].isNotifying,r.push(a)}params[C.kCharacteristics]=r,params[C.kPeripheralUUID]=n.uuid,params[C.kServiceUUID]=this.uuid,s.write(C.kGetCharacteristics,params,e)}},this.addCharacteristic=function(e){var t=new Characteristic(s,n,this,e);return this.characteristics[t.uuid]=t,t}}"object"==typeof t&&t+""=="[object process]"&&"undefined"!=typeof r&&(r.Service=i)}).call(this,e("_process"))},{"./characteristic.js":4,"./constants.js":5,_process:20}],12:[function(e,t,r){function i(e){e>>>=0;var t="0000000"+e.toString(16);return t=t.substr(-8),t+"-0000-1000-8000-00805f9b34fb"}function a(e){var r=t.exports.BluetoothUUID[e];return function(t){if("string"==typeof t&&(t=t.toLowerCase()),"number"==typeof t)return i(t);if(s.test(t))return t;if(r.hasOwnProperty(t))return r[t];throw new NamedError("SyntaxError",'"'+t+'" is not a known '+e+" name.")}}var s=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;t.exports.BluetoothUUID={},t.exports.BluetoothUUID.canonicalUUID=i,t.exports.BluetoothUUID.service={alert_notification:i(6161),automation_io:i(6165),battery_service:i(6159),blood_pressure:i(6160),body_composition:i(6171),bond_management:i(6174),continuous_glucose_monitoring:i(6175),current_time:i(6149),cycling_power:i(6168),cycling_speed_and_cadence:i(6166),device_information:i(6154),environmental_sensing:i(6170),generic_access:i(6144),generic_attribute:i(6145),glucose:i(6152),health_thermometer:i(6153),heart_rate:i(6157),human_interface_device:i(6162),immediate_alert:i(6146),indoor_positioning:i(6177),internet_protocol_support:i(6176),link_loss:i(6147),location_and_navigation:i(6169),next_dst_change:i(6151),phone_alert_status:i(6158),pulse_oximeter:i(6178),reference_time_update:i(6150),running_speed_and_cadence:i(6164),scan_parameters:i(6163),tx_power:i(6148),user_data:i(6172),weight_scale:i(6173)},t.exports.BluetoothUUID.characteristic={aerobic_heart_rate_lower_limit:i(10878),aerobic_heart_rate_upper_limit:i(10884),aerobic_threshold:i(10879),age:i(10880),aggregate:i(10842),alert_category_id:i(10819),alert_category_id_bit_mask:i(10818),alert_level:i(10758),alert_notification_control_point:i(10820),alert_status:i(10815),altitude:i(10931),anaerobic_heart_rate_lower_limit:i(10881),anaerobic_heart_rate_upper_limit:i(10882),anaerobic_threshold:i(10883),analog:i(10840),apparent_wind_direction:i(10867),apparent_wind_speed:i(10866),"gap.appearance":i(10753),barometric_pressure_trend:i(10915),battery_level:i(10777),blood_pressure_feature:i(10825),blood_pressure_measurement:i(10805),body_composition_feature:i(10907),body_composition_measurement:i(10908),body_sensor_location:i(10808),bond_management_control_point:i(10916),bond_management_feature:i(10917),boot_keyboard_input_report:i(10786),boot_keyboard_output_report:i(10802),boot_mouse_input_report:i(10803),"gap.central_address_resolution_support":i(10918),cgm_feature:i(10920),cgm_measurement:i(10919),cgm_session_run_time:i(10923),cgm_session_start_time:i(10922),cgm_specific_ops_control_point:i(10924),cgm_status:i(10921),csc_feature:i(10844),csc_measurement:i(10843),current_time:i(10795),cycling_power_control_point:i(10854),cycling_power_feature:i(10853),cycling_power_measurement:i(10851),cycling_power_vector:i(10852),database_change_increment:i(10905),date_of_birth:i(10885),date_of_threshold_assessment:i(10886),date_time:i(10760),day_date_time:i(10762),day_of_week:i(10761),descriptor_value_changed:i(10877),"gap.device_name":i(10752),dew_point:i(10875),digital:i(10838),dst_offset:i(10765),elevation:i(10860),email_address:i(10887),exact_time_256:i(10764),fat_burn_heart_rate_lower_limit:i(10888),fat_burn_heart_rate_upper_limit:i(10889),firmware_revision_string:i(10790),first_name:i(10890),five_zone_heart_rate_limits:i(10891),floor_number:i(10930),gender:i(10892),glucose_feature:i(10833),glucose_measurement:i(10776),glucose_measurement_context:i(10804),gust_factor:i(10868),hardware_revision_string:i(10791),heart_rate_control_point:i(10809),heart_rate_max:i(10893),heart_rate_measurement:i(10807),heat_index:i(10874),height:i(10894),hid_control_point:i(10828),hid_information:i(10826),hip_circumference:i(10895),humidity:i(10863),"ieee_11073-20601_regulatory_certification_data_list":i(10794),indoor_positioning_configuration:i(10925),intermediate_blood_pressure:i(10806),intermediate_temperature:i(10782),irradiance:i(10871),language:i(10914),last_name:i(10896),latitude:i(10926),ln_control_point:i(10859),ln_feature:i(10858),"local_east_coordinate.xml":i(10929),local_north_coordinate:i(10928),local_time_information:i(10767),location_and_speed:i(10855),location_name:i(10933),longitude:i(10927),magnetic_declination:i(10796),magnetic_flux_density_2D:i(10912),magnetic_flux_density_3D:i(10913),manufacturer_name_string:i(10793),maximum_recommended_heart_rate:i(10897),measurement_interval:i(10785),model_number_string:i(10788),navigation:i(10856),new_alert:i(10822),"gap.peripheral_preferred_connection_parameters":i(10756),"gap.peripheral_privacy_flag":i(10754),plx_continuous_measurement:i(10847),plx_features:i(10848),plx_spot_check_measurement:i(10846),pnp_id:i(10832),pollen_concentration:i(10869),position_quality:i(10857),pressure:i(10861),protocol_mode:i(10830),rainfall:i(10872),"gap.reconnection_address":i(10755),record_access_control_point:i(10834),reference_time_information:i(10772),report:i(10829),report_map:i(10827),resting_heart_rate:i(10898),ringer_control_point:i(10816),ringer_setting:i(10817),rsc_feature:i(10836),rsc_measurement:i(10835),sc_control_point:i(10837),scan_interval_window:i(10831),scan_refresh:i(10801),sensor_location:i(10845),serial_number_string:i(10789),"gatt.service_changed":i(10757),software_revision_string:i(10792),sport_type_for_aerobic_and_anaerobic_thresholds:i(10899),supported_new_alert_category:i(10823),supported_unread_alert_category:i(10824),system_id:i(10787),temperature:i(10862),temperature_measurement:i(10780),temperature_type:i(10781),three_zone_heart_rate_limits:i(10900),time_accuracy:i(10770),time_source:i(10771),time_update_control_point:i(10774),time_update_state:i(10775),time_with_dst:i(10769),time_zone:i(10766),true_wind_direction:i(10865),true_wind_speed:i(10864),two_zone_heart_rate_limit:i(10901),tx_power_level:i(10759),uncertainty:i(10932),unread_alert_status:i(10821),user_control_point:i(10911),user_index:i(10906),uv_index:i(10870),vo2_max:i(10902),waist_circumference:i(10903),weight:i(10904),weight_measurement:i(10909),weight_scale_feature:i(10910),wind_chill:i(10873)},t.exports.BluetoothUUID.descriptor={"gatt.characteristic_extended_properties":i(10496),"gatt.characteristic_user_description":i(10497),"gatt.client_characteristic_configuration":i(10498),"gatt.server_characteristic_configuration":i(10499),"gatt.characteristic_presentation_format":i(10500),"gatt.characteristic_aggregate_format":i(10501),valid_range:i(10502),external_report_reference:i(10503),report_reference:i(10504),value_trigger_setting:i(10506),es_configuration:i(10507),es_measurement:i(10508),es_trigger_setting:i(10509)},t.exports.BluetoothUUID.getService=a("service"),t.exports.BluetoothUUID.getCharacteristic=a("characteristic"),t.exports.BluetoothUUID.getDescriptor=a("descriptor")},{}],13:[function(e,t,r){function i(e){return 8==e.indexOf(a)?0==e.indexOf("0000")?e.substring(4,8):e.substring(0,8):e}var a="-0000-1000-8000-00805F9B34FB";t.exports.toVensiUUID=function(e){switch(typeof e){case"string":return i(e.toUpperCase());case"number":return Number(e).toString(16).toUpperCase();default:return}},t.exports.toWbUUID=function(e){return e&&(e=e.toLowerCase()),e},t.exports.hexAsArray=function(e){var t=[];e.length%2==1&&(e="0"+e);for(var r=0;r<e.length-1;r+=2)t.push(parseInt(e.substr(r,2),16));return t},t.exports.arrayAsHex=function(e){var t="";for(var r in e){byte=e[r];var i=(255&byte).toString(16);1==i.length&&(i="0"+i),t+=i}return t.toUpperCase()},t.exports.uncaughtError=function(e){},t.exports.errorLoggingPromise=function(e){return new Promise(function(r,i){try{e(r,i)}catch(a){throw t.exports.uncaughtError(a),a}})}},{}],14:[function(e,t,r){function i(e,t){n.instantiateEmitter(this);var r=this;this._gattIp=e._gattIp,this._service=e,this._gattipCharacteristic=t,t.wbCharacteristic=this,this._properties=new a(t.properties),this._value=null,Object.defineProperty(this,"uuid",{get:function(){return s.toWbUUID(r._gattipCharacteristic.uuid)}}),Object.defineProperty(this,"service",{get:function(){return r._service}}),Object.defineProperty(this,"properties",{get:function(){return r._properties}}),Object.defineProperty(this,"value",{get:function(){return r._value}}),this.getAllDescriptors=function(e){return s.errorLoggingPromise(function(e,t){t("Not implemented")})},this.getDescriptor=function(e){var t=this;return s.errorLoggingPromise(function(r,i){var a=s.toVensiUUID(t._gattIp.BluetoothUUID.getDescriptor(e));if("undefined"==typeof a)i("Unable to find descriptor with requested UUID "+e);else{var n=t._gattipCharacteristic.descriptors[a];n?r(new o(t,n)):i("Descriptor "+e+" not found")}})},this.readValue=function(){var e=this;return s.errorLoggingPromise(function(t,r){e._gattIp.onerror=function(t){e._gattIp.onerror=s.uncaughtError,r(t)},e.onRead=function(i){delete e.onRead,i?t(i):r("Unable to obtain value")},e._gattipCharacteristic.read()})},this.writeValue=function(e){var t=this;return s.errorLoggingPromise(function(r,i){var a=s.arrayAsHex(Array.prototype.slice.call(e));t._gattIp.onerror=function(e){t._gattIp.onerror=s.uncaughtError,i(e)},t._gattipCharacteristic.write(a,function(e){}),1==t._gattipCharacteristic.properties.WriteWithoutResponse.enabled||1==t._gattipCharacteristic.properties.Indicate.enabled?r():t.onWrite=function(){delete t.onWrite,r()}})},this.startNotifications=function(){var e=this;return s.errorLoggingPromise(function(t,r){return e._gattipCharacteristic.isNotifying?void t():(e._gattIp.onerror=function(t){e._gattIp.onerror=s.uncaughtError,r(t)},e.onSetNotify=function(r){delete onSetNotify,e.onValueNotification=function(){var t=s.hexAsArray(e._gattipCharacteristic.value);e._value=new DataView(new Uint8Array(t).buffer),e.emit("characteristicvaluechanged",{target:e})},t()},void e._gattipCharacteristic.notify(!0))})},this.stopNotifications=function(){var e=this;return s.errorLoggingPromise(function(t,r){return e.onValueNotification?(e._gattIp.onerror=function(t){e._gattIp.onerror=s.uncaughtError,r(t)},void e._gattipCharacteristic.notify(!1,function(r){delete e.onValueNotification,t()})):void t()})},this.addEventListener=function(e,t){this.on(e,t)}}function a(e){function t(e){return e.charAt(0).toUpperCase()+e.slice(1)}for(var r in c){wbPropName=c[r];var i=t(wbPropName);"object"==typeof e[i]?this[wbPropName]=1==e[i].enabled:"reliableWrite"!=wbPropName&&"writableAuxiliaries"!=wbPropName||(0===e.ExtendedProperties.enabled?this[wbPropName]=!1:this[wbPropName]=!1)}}var s=e("./util.js"),n=e("./event-emitter"),o=e("./wb-descriptor").BluetoothGattDescriptor,c=["broadcast","read","writeWithoutResponse","write","notify","indicate","authenticatedSignedWrites","reliableWrite","writableAuxiliaries"];t.exports.BluetoothGattCharacteristic=i,n.makeEmitter(i)},{"./event-emitter":2,"./util.js":13,"./wb-descriptor":15}],15:[function(e,t,r){function i(e,t){this._gattIp=e._gattIp,this._characteristic=e,this._gattIpDescriptor=t,this._value=null}var a=e("./util.js");t.exports.BluetoothGattDescriptor=i,i.prototype={get uuid(){return a.toWbUUID(this._gattIpDescriptor.uuid)},get characteristic(){return this._characteristic},get value(){return this._value},readValue:function(){var e=this;e._gattIp.onerror=function(t){e._gattIp.onerror=a.uncaughtError,reject(t)},e._gattIpDescriptor.read(function(e){var t=e.bp;if(t){var r=a.hexAsArray(t);fulfill(new DataView(new Uint8Array(r).buffer))}else reject("Unable to obtain value")})},writeValue:function(e){var t=this;return a.errorLoggingPromise(function(r,i){t._gattIp.onerror=function(e){t._gattIp.onerror=a.uncaughtError,i(e)};var s=a.arrayAsHex(Array.prototype.slice.call(e));t._gattIpDescriptor.write(s,function(e){r()})})}}},{"./util.js":13}],16:[function(e,t,r){function i(e,t){this._gattIp=e,this._gattIpPeripheral=t}var a=e("./util.js"),s=e("./wb-service").BluetoothGattService;t.exports.BluetoothDevice=i,i.prototype={get name(){return this._gattIpPeripheral.name},get deviceClass(){},get vendorIdSource(){},get vendorId(){},get productId(){},get productVersion(){},get paired(){return!1},get connected(){return this._gattIpPeripheral.isConnected},get uuids(){return this._gattIpPeripheral.serviceUUIDs},connect:function(){var e=this;return a.errorLoggingPromise(function(t,r){e._gattIp.onerror=function(t){e._gattIp.onerror=a.uncaughtError,r(t)};setTimeout(function(){r("Timed out")},3e4);e._gattIp.onconnect=function(i,a){return a?void r(JSON.stringify(a)):(e._gattIpPeripheral=e._gattIp.peripherals[e._gattIpPeripheral.uuid],void t(e))},e._gattIp.onwriteValue=function(e,t,r){if(e&&t&&r){var i=r.wbCharacteristic;i.onWrite&&i.onWrite()}},e._gattIp.onupdateValue=function(e,t,r){if(e&&t&&r){var i=r.wbCharacteristic;if(i.onSetNotify&&i.onSetNotify(r.isNotifying),i.onRead){var s=a.hexAsArray(r.value);i.onRead(new DataView(new Uint8Array(s).buffer))}i.onValueNotification&&i.onValueNotification()}},e._gattIp.onerror=function(e){r(e)},e._gattIpPeripheral.connect()})},disconnect:function(){var e=this;return a.errorLoggingPromise(function(t,r){e._gattIp.ondisconnect=function(){t(e)},e._gattIp.onerror=function(e){r(e)},e._gattIpPeripheral.disconnect()})},getAllServices:function(e){return a.errorLoggingPromise(function(e,t){t("Not implemented")})},getService:function(e){var t=this;return a.errorLoggingPromise(function(r,i){var n=a.toVensiUUID(t._gattIp.BluetoothUUID.getService(e));if("undefined"==typeof n)i("Unable to find service with requested UUID "+e);else{var o=t._gattIpPeripheral.services[n];o?r(new s(t,o)):(o=t._gattIpPeripheral.services[e],o?r(new s(t,o)):i("Service "+e+" not found"))}})}},i.prototype.connectGATT=i.prototype.connect,i.prototype.getPrimaryService=i.prototype.getService},{"./util.js":13,"./wb-service":17}],17:[function(e,t,r){function i(e,t){this._gattIp=e._gattIp,this._device=e,this._gattIpService=t}var a=e("./util.js"),s=e("./wb-characteristic").BluetoothGattCharacteristic;t.exports.BluetoothGattService=i,i.prototype={get uuid(){return a.toWbUUID(this._service.uuid)},get isPrimary(){return!0},get device(){return this._device},getAllCharacteristics:function(e){return a.errorLoggingPromise(function(e,t){t("Not implemented")})},getCharacteristic:function(e){var t=this;return a.errorLoggingPromise(function(r,i){var n=a.toVensiUUID(t._gattIp.BluetoothUUID.getCharacteristic(e));if("undefined"==typeof n)i("Unable to find characteristic with requested UUID "+e);else{var o=t._gattIpService.characteristics[n];if(o)r(new s(t,o));else{var o=t._gattIpService.characteristics[e];o?r(new s(t,o)):i("Characteristic "+e+" not found")}}})},getAllIncludedServices:function(e){return a.errorLoggingPromise(function(e,t){t("Not implemented")})},getIncludedService:function(e){return a.errorLoggingPromise(function(e,t){t("Not implemented")})}}},{"./util.js":13,"./wb-characteristic":14}],18:[function(e,t,r){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function s(e){return"number"==typeof e}function n(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!s(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,r,i,s,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(r=this._events[e],o(r))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,s=new Array(i-1),c=1;i>c;c++)s[c-1]=arguments[c];r.apply(this,s)}else if(n(r)){for(i=arguments.length,s=new Array(i-1),c=1;i>c;c++)s[c-1]=arguments[c];for(u=r.slice(),i=u.length,c=0;i>c;c++)u[c].apply(this,s)}return!0},i.prototype.addListener=function(e,t){var r;if(!a(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?n(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,n(this._events[e])&&!this._events[e].warned){var r;r=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,"function"==typeof console.trace)}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}if(!a(t))throw TypeError("listener must be a function");var i=!1;return r.listener=t,this.on(e,r),this},i.prototype.removeListener=function(e,t){var r,i,s,o;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,i=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(r)){for(o=s;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){i=o;break}if(0>i)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],a(r))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.listenerCount=function(e,t){var r;return r=e._events&&e._events[t]?a(e._events[t])?1:e._events[t].length:0}},{}],19:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],20:[function(e,t,r){function i(){p=!1,o.length?u=o.concat(u):h=-1,u.length&&a()}function a(){if(!p){var e=setTimeout(i);p=!0;for(var t=u.length;t;){for(o=u,u=[];++h<t;)o&&o[h].run();h=-1,t=u.length}o=null,p=!1,clearTimeout(e)}}function s(e,t){this.fun=e,this.array=t}function n(){}var o,c=t.exports={},u=[],p=!1,h=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new s(e,t)),1!==u.length||p||setTimeout(a,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=n,c.addListener=n,c.once=n,c.off=n,c.removeListener=n,c.removeAllListeners=n,c.emit=n,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],21:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],22:[function(e,t,r){(function(t,i){function a(e,t){var i={seen:[],stylize:n};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),v(t)?i.showHidden=t:t&&r._extend(i,t),U(i.showHidden)&&(i.showHidden=!1),U(i.depth)&&(i.depth=2),U(i.colors)&&(i.colors=!1),U(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=s),c(i,e,i.depth)}function s(e,t){var r=a.styles[t];return r?"["+a.colors[r][0]+"m"+e+"["+a.colors[r][1]+"m":e}function n(e,t){return e}function o(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function c(e,t,i){if(e.customInspect&&t&&S(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var a=t.inspect(i,e);return k(a)||(a=c(e,a,i)),a}var s=u(e,t);if(s)return s;var n=Object.keys(t),v=o(n);if(e.showHidden&&(n=Object.getOwnPropertyNames(t)),y(t)&&(n.indexOf("message")>=0||n.indexOf("description")>=0))return p(t);if(0===n.length){if(S(t)){var m=t.name?": "+t.name:"";return e.stylize("[Function"+m+"]","special")}if(I(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(b(t))return e.stylize(Date.prototype.toString.call(t),"date");if(y(t))return p(t)}var C="",_=!1,g=["{","}"];if(f(t)&&(_=!0,g=["[","]"]),S(t)){var U=t.name?": "+t.name:"";C=" [Function"+U+"]"}if(I(t)&&(C=" "+RegExp.prototype.toString.call(t)),b(t)&&(C=" "+Date.prototype.toUTCString.call(t)),y(t)&&(C=" "+p(t)),0===n.length&&(!_||0==t.length))return g[0]+C+g[1];if(0>i)return I(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var D;return D=_?h(e,t,i,v,n):n.map(function(r){return l(e,t,i,v,r,_)}),e.seen.pop(),d(D,C,g)}function u(e,t){if(U(t))return e.stylize("undefined","undefined");if(k(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return _(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function p(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,r,i,a){for(var s=[],n=0,o=t.length;o>n;++n)E(t,String(n))?s.push(l(e,t,r,i,String(n),!0)):s.push("");return a.forEach(function(a){a.match(/^\d+$/)||s.push(l(e,t,r,i,a,!0))}),s}function l(e,t,r,i,a,s){var n,o,u;if(u=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]},u.get?o=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(o=e.stylize("[Setter]","special")),E(i,a)||(n="["+a+"]"),o||(e.seen.indexOf(u.value)<0?(o=m(r)?c(e,u.value,null):c(e,u.value,r-1),o.indexOf("\n")>-1&&(o=s?o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+o.split("\n").map(function(e){return"   "+e}).join("\n"))):o=e.stylize("[Circular]","special")),U(n)){if(s&&a.match(/^\d+$/))return o;n=JSON.stringify(""+a),n.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(n=n.substr(1,n.length-2),n=e.stylize(n,"name")):(n=n.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),n=e.stylize(n,"string"))}return n+": "+o}function d(e,t,r){var i=0,a=e.reduce(function(e,t){return i++,t.indexOf("\n")>=0&&i++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return a>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1];
}function f(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function m(e){return null===e}function C(e){return null==e}function _(e){return"number"==typeof e}function k(e){return"string"==typeof e}function g(e){return"symbol"==typeof e}function U(e){return void 0===e}function I(e){return D(e)&&"[object RegExp]"===P(e)}function D(e){return"object"==typeof e&&null!==e}function b(e){return D(e)&&"[object Date]"===P(e)}function y(e){return D(e)&&("[object Error]"===P(e)||e instanceof Error)}function S(e){return"function"==typeof e}function w(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function P(e){return Object.prototype.toString.call(e)}function E(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var R=/%[sdj%]/g;r.format=function(e){if(!k(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(a(arguments[r]));return t.join(" ")}for(var r=1,i=arguments,s=i.length,n=String(e).replace(R,function(e){if("%%"===e)return"%";if(r>=s)return e;switch(e){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(t){return"[Circular]"}default:return e}}),o=i[r];s>r;o=i[++r])n+=m(o)||!D(o)?" "+o:" "+a(o);return n},r.deprecate=function(e,a){function s(){if(!n){if(t.throwDeprecation)throw new Error(a);t.traceDeprecation,n=!0}return e.apply(this,arguments)}if(U(i.process))return function(){return r.deprecate(e,a).apply(this,arguments)};if(t.noDeprecation===!0)return e;var n=!1;return s};var A,T={};r.debuglog=function(e){if(U(A)&&(A=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!T[e])if(new RegExp("\\b"+e+"\\b","i").test(A)){t.pid;T[e]=function(){r.format.apply(r,arguments)}}else T[e]=function(){};return T[e]},r.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=f,r.isBoolean=v,r.isNull=m,r.isNullOrUndefined=C,r.isNumber=_,r.isString=k,r.isSymbol=g,r.isUndefined=U,r.isRegExp=I,r.isObject=D,r.isDate=b,r.isError=y,r.isFunction=S,r.isPrimitive=w,r.isBuffer=e("./support/isBuffer");r.log=function(){},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!D(t))return e;for(var r=Object.keys(t),i=r.length;i--;)e[r[i]]=t[r[i]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":21,_process:20,inherits:19}],23:[function(e,t,r){function i(e,t){var r;return r=t?new s(e,t):new s(e)}var a=function(){return this}(),s=a.WebSocket||a.MozWebSocket,n=e("./version");t.exports={w3cwebsocket:s?i:null,version:n}},{"./version":24}],24:[function(e,t,r){t.exports=e("../package.json").version},{"../package.json":25}],25:[function(e,t,r){t.exports={_args:[["websocket@latest","/Users/Admin/Documents/Malli_Workspace/BitBucket/wb-polyfill/lib/blueapp-wb"]],_from:"websocket@latest",_id:"websocket@1.0.22",_inCache:!0,_installable:!0,_location:"/websocket",_nodeVersion:"3.3.1",_npmUser:{email:"brian@worlize.com",name:"theturtle32"},_npmVersion:"2.14.3",_phantomChildren:{},_requested:{name:"websocket",raw:"websocket@latest",rawSpec:"latest",scope:null,spec:"latest",type:"tag"},_requiredBy:["/blueapp-wb","/gatt-ip"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.22.tgz",_shasum:"8c33e3449f879aaf518297c9744cebf812b9e3d8",_shrinkwrap:null,_spec:"websocket@latest",_where:"/Users/Admin/Documents/Malli_Workspace/BitBucket/wb-polyfill/lib/blueapp-wb",author:{email:"brian@worlize.com",name:"Brian McKelvey",url:"https://www.worlize.com/"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},config:{verbose:!1},contributors:[{name:"Iaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"~2.2.0",nan:"~2.0.5","typedarray-to-buffer":"~3.0.3",yaeti:"~0.0.4"},description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^0.0.1",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^1.11.2","jshint-stylish":"^1.0.2",tape:"^4.0.1"},directories:{lib:"./lib"},dist:{shasum:"8c33e3449f879aaf518297c9744cebf812b9e3d8",tarball:"https://registry.npmjs.org/websocket/-/websocket-1.0.22.tgz"},engines:{node:">=0.8.0"},gitHead:"19108bbfd7d94a5cd02dbff3495eafee9e901ca4",homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["RFC-6455","client","comet","networking","push","realtime","server","socket","websocket","websockets"],license:"Apache-2.0",main:"index",maintainers:[{name:"theturtle32",email:"brian@worlize.com"}],name:"websocket",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.22"}},{}]},{},[1]);